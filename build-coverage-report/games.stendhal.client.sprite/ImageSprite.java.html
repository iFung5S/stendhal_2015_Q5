<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ImageSprite.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.client.sprite</a> &gt; <span class="el_source">ImageSprite.java</span></div><h1>ImageSprite.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2010 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.client.sprite;


import games.stendhal.client.gui.TransparencyMode;

import java.awt.Graphics;
import java.awt.GraphicsConfiguration;
import java.awt.GraphicsEnvironment;
import java.awt.Image;

/**
 * A sprite to be displayed on the screen. Note that a sprite contains no state
 * information, i.e. its just the image and not the location. This allows us to
 * use a single sprite in lots of different places without having to store
 * multiple copies of the image.
 * 
 * @author Kevin Glass
 */
public class ImageSprite implements Sprite {
	/** The image to be drawn for this sprite. */
	private Image image;

	/**
	 * The identifier reference.
	 */
	private Object reference;

	/**
	 * Create a new sprite based on an image.
	 * 
	 * @param image
	 *            The image that is this sprite
	 */
	public ImageSprite(final Image image) {
<span class="fc" id="L47">		this(image, null);</span>
<span class="fc" id="L48">	}</span>

	/**
	 * Create a new sprite based on an image.
	 * 
	 * @param image
	 *            The image that is this sprite.
	 * @param reference
	 *            The sprite reference, or null.
	 */
<span class="fc" id="L58">	public ImageSprite(final Image image, final Object reference) {</span>
<span class="fc" id="L59">		this.image = image;</span>
<span class="fc" id="L60">		this.reference = reference;</span>
<span class="fc" id="L61">	}</span>

	/**
	 * Create an image sprite from another sprite.
	 * 
	 * @param sprite
	 *            The source sprite.
	 */
	public ImageSprite(final Sprite sprite) {
<span class="nc" id="L70">		this(sprite, null);</span>
<span class="nc" id="L71">	}</span>

	/**
	 * Create a copy of another sprite.
	 * 
	 * @param sprite
	 *            The source sprite.
	 * @param reference
	 *            The sprite reference, or null.
	 */
<span class="nc" id="L81">	private ImageSprite(final Sprite sprite, final Object reference) {</span>
<span class="nc" id="L82">		this.reference = reference;</span>

<span class="nc" id="L84">		image = getGC().createCompatibleImage(sprite.getWidth(),</span>
				sprite.getHeight(), TransparencyMode.TRANSPARENCY);

<span class="nc" id="L87">		sprite.draw(image.getGraphics(), 0, 0);</span>
<span class="nc" id="L88">	}</span>

	//
	// ImageSprite
	//

	protected static GraphicsConfiguration getGC() {
<span class="fc" id="L95">		return GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice().getDefaultConfiguration();</span>
	}

	/**
	 * Get the graphics context of the underlying image.
	 * 
	 * @return The graphics context.
	 */
	public Graphics getGraphics() {
<span class="nc" id="L104">		return image.getGraphics();</span>
	}

	//
	// Sprite
	//
	/**
	 * Create a sub-region of this sprite. &lt;strong&gt;NOTE: This does not use
	 * caching.&lt;/strong&gt;
	 * 
	 * @param x
	 *            The starting X coordinate.
	 * @param y
	 *            The starting Y coordinate.
	 * @param width
	 *            The region width.
	 * @param height
	 *            The region height.
	 * @param ref
	 *            The sprite reference.
	 * 
	 * @return A new sprite.
	 */
	@Override
	public Sprite createRegion(final int x, final int y, int width,
			int height, final Object ref) {
<span class="fc" id="L130">		final int iwidth = getWidth();</span>
<span class="fc" id="L131">		final int iheight = getHeight();</span>

<span class="pc bpc" id="L133" title="2 of 4 branches missed.">		if ((x &gt;= iwidth) || (y &gt;= iheight)) {</span>
			/*
			 * Outside of image (nothing to draw)
			 */
<span class="nc" id="L137">			return new EmptySprite(width, height, ref);</span>
		}
		// Exclude regions outside the original image
<span class="fc" id="L140">		width = Math.min(width, iwidth);</span>
<span class="fc" id="L141">		height = Math.min(height, iheight);</span>

		/*
		 * Full copy method (the memory hog)
		 */
<span class="fc" id="L146">		final GraphicsConfiguration gc = getGC();</span>

<span class="fc" id="L148">		final Image imageTemp = gc.createCompatibleImage(width, height,</span>
				TransparencyMode.TRANSPARENCY);

<span class="fc" id="L151">		draw(imageTemp.getGraphics(), 0, 0, x, y, width, height);</span>

<span class="fc" id="L153">		return new ImageSprite(imageTemp, ref);</span>
	}

	/**
	 * Draw the sprite onto the graphics context provided.
	 * 
	 * @param g
	 *            The graphics context on which to draw the sprite
	 * @param x
	 *            The x location at which to draw the sprite
	 * @param y
	 *            The y location at which to draw the sprite
	 */
	@Override
	public void draw(final Graphics g, final int x, final int y) {
<span class="nc" id="L168">		g.drawImage(image, x, y, null);</span>
<span class="nc" id="L169">	}</span>

	/**
	 * Draws the image.
	 * 
	 * @param g
	 *            the graphics context where to draw to
	 * @param destx
	 *            destination x
	 * @param desty
	 *            destination y
	 * @param x
	 *            the source x
	 * @param y
	 *            the source y
	 * @param w
	 *            the width
	 * @param h
	 *            the height
	 */
	@Override
	public void draw(final Graphics g, final int destx, final int desty, final int x, final int y, final int w,
			final int h) {
<span class="fc" id="L192">		g.drawImage(image, destx, desty, destx + w, desty + h, x, y, x + w, y</span>
				+ h, null);
<span class="fc" id="L194">	}</span>

	/**
	 * Get the height of the drawn sprite.
	 * 
	 * @return The height in pixels of this sprite
	 */
	@Override
	public int getHeight() {
<span class="fc" id="L203">		return image.getHeight(null);</span>
	}

	/**
	 * Get the sprite reference. This identifier is an externally opaque object
	 * that implements equals() and hashCode() to uniquely/repeatably reference
	 * a keyed sprite.
	 * 
	 * @return The reference identifier, or &lt;code&gt;null&lt;/code&gt; if not
	 *         referencable.
	 */
	@Override
	public Object getReference() {
<span class="fc" id="L216">		return reference;</span>
	}

	/**
	 * Get the width of the drawn sprite.
	 * 
	 * @return The width in pixels of this sprite
	 */
	@Override
	public int getWidth() {
<span class="fc" id="L226">		return image.getWidth(null);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>