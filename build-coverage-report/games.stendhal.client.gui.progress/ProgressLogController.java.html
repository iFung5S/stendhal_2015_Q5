<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ProgressLogController.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.client.gui.progress</a> &gt; <span class="el_source">ProgressLogController.java</span></div><h1>ProgressLogController.java</h1><pre class="source lang-java linenums">/***************************************************************************
 *                   (C) Copyright 2003-2010 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.client.gui.progress;

import games.stendhal.client.StendhalClient;
import games.stendhal.client.entity.User;
import games.stendhal.client.gui.WindowUtils;
import games.stendhal.common.constants.Actions;
import games.stendhal.common.grammar.Grammar;

import java.awt.Window;
import java.util.Collection;
import java.util.List;

import javax.swing.SwingUtilities;

import marauroa.common.game.RPAction;

public class ProgressLogController {
	/** Controller instance */
	private static ProgressLogController instance;

	/**
	 * Progress window. This should be accessed only through getProgressLog(),
	 * which ensures the window has been created.
	 */
	private ProgressLog progressLog;

	/**
	 * Get the book controller instance.
	 *
	 * @return controller instance
	 */
	public static synchronized ProgressLogController get() {
<span class="nc bnc" id="L44" title="All 2 branches missed.">		if (instance == null) {</span>
<span class="nc" id="L45">			instance = new ProgressLogController();</span>
		}
<span class="nc" id="L47">		return instance;</span>
	}

	/**
	 * Create a new ProgressLogController.
	 */
<span class="nc" id="L53">	private ProgressLogController() {</span>
<span class="nc" id="L54">	}</span>

	/**
	 * Set the repeatable quest names.
	 * 
	 * @param repeatable repeatable quests
	 */
	public void setRepeatable(final Collection&lt;String&gt; repeatable) {
<span class="nc" id="L62">		SwingUtilities.invokeLater(new Runnable() {</span>
			@Override
			public void run() {
<span class="nc" id="L65">				getProgressLog().setRepeatable(repeatable);</span>
<span class="nc" id="L66">			}</span>
		});
<span class="nc" id="L68">	}</span>
	/**
	 * Show available progress categories.
	 *
	 * @param categories
	 */
	public void showCategories(final List&lt;String&gt; categories) {
<span class="nc" id="L75">		SwingUtilities.invokeLater(new Runnable() {</span>
			@Override
			public void run() {
				// Prepare appropriate action for content clicks
<span class="nc" id="L79">				RequestAction contentAction = new RequestAction();</span>
<span class="nc" id="L80">				contentAction.setDataKey(&quot;progress_type&quot;);</span>

<span class="nc" id="L82">				getProgressLog().setPages(categories, contentAction);</span>
<span class="nc" id="L83">				showWindow();</span>
<span class="nc" id="L84">			}</span>
		});
<span class="nc" id="L86">	}</span>

	/**
	 * Show a list of items in a category.
	 *
	 * @param category
	 * @param items
	 */
	public void showCategorySummary(final String category, final List&lt;String&gt; items) {
<span class="nc" id="L95">		SwingUtilities.invokeLater(new Runnable() {</span>
			@Override
			public void run() {
				// Prepare appropriate action for content clicks
<span class="nc" id="L99">				RequestAction contentAction = new RequestAction();</span>
<span class="nc" id="L100">				contentAction.setDataKey(&quot;item&quot;);</span>
<span class="nc" id="L101">				contentAction.setProgressType(category);</span>

<span class="nc" id="L103">				getProgressLog().setPageIndex(category, items, contentAction);</span>
<span class="nc" id="L104">				showWindow();</span>
<span class="nc" id="L105">			}</span>
		});
<span class="nc" id="L107">	}</span>

	/**
	 * Show the description of an item in a category.
	 *
	 * @param category
	 * @param item item to be described
	 * @param description description
	 * @param information information
	 * @param details paragraphs
	 */
	public void showDescription(final String category, final String item, final String description, final String information, final List&lt;String&gt; details) {
<span class="nc" id="L119">		SwingUtilities.invokeLater(new Runnable() {</span>
			@Override
			public void run() {
<span class="nc" id="L122">				getProgressLog().setPageContent(category, item, description, information, details);</span>
<span class="nc" id="L123">				showWindow();</span>
<span class="nc" id="L124">			}</span>
		});
<span class="nc" id="L126">	}</span>

	/**
	 * Get the log window, and create it if it has not been created before.
	 * This method must be called in the event dispatch thread.
	 *
	 * @return log window
	 */
	private ProgressLog getProgressLog() {
<span class="nc bnc" id="L135" title="All 2 branches missed.">		if (progressLog == null) {</span>
<span class="nc" id="L136">			progressLog = new ProgressLog(Grammar.suffix_s(User.getCharacterName()) + &quot; travel log&quot;);</span>
		}
<span class="nc" id="L138">		return progressLog;</span>
	}

	/**
	 * Show the window, if it's not already visible. This must not be called
	 * outside the event dispatch thread.
	 */
	private void showWindow() {
<span class="nc" id="L146">		Window window = getProgressLog().getWindow();</span>
<span class="nc" id="L147">		WindowUtils.restoreSize(window);</span>
<span class="nc" id="L148">		window.setVisible(true);</span>
<span class="nc" id="L149">	}</span>

	/**
	 * A class for storing progress query information.
	 */
<span class="nc" id="L154">	private static class RequestAction implements ProgressStatusQuery {</span>
		private String progressType;
		private String dataKey;

		/**
		 * Send the progress query to the server.
		 *
		 * @param data the value of dataKey, if set
		 */
		@Override
		public void fire(String data) {
<span class="nc" id="L165">			RPAction action = new RPAction();</span>
<span class="nc" id="L166">			action.put(&quot;type&quot;, Actions.PROGRESS_STATUS);</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">			if (progressType != null) {</span>
<span class="nc" id="L168">				action.put(&quot;progress_type&quot;, progressType);</span>
			}
<span class="nc bnc" id="L170" title="All 2 branches missed.">			if (dataKey != null) {</span>
<span class="nc" id="L171">				action.put(dataKey, data);</span>
			}

<span class="nc" id="L174">			StendhalClient.get().send(action);</span>
<span class="nc" id="L175">		}</span>

		/**
		 * Set the action key whose value will be passed as a parameter to
		 * fire()
		 *
		 * @param key
		 */
		void setDataKey(String key) {
<span class="nc" id="L184">			dataKey = key;</span>
<span class="nc" id="L185">		}</span>

		/**
		 * Set the &quot;progress_type&quot; value for the query.
		 *
		 * @param type
		 */
		void setProgressType(String type) {
<span class="nc" id="L193">			progressType = type;</span>
<span class="nc" id="L194">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>