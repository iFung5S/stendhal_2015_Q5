<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>textClient.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.client</a> &gt; <span class="el_source">textClient.java</span></div><h1>textClient.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                      (C) Copyright 2003 - Marauroa                      *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.client;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import marauroa.client.net.IPerceptionListener;
import marauroa.client.net.PerceptionHandler;
import marauroa.common.game.RPAction;
import marauroa.common.game.RPObject;
import marauroa.common.net.message.MessageS2CPerception;
import marauroa.common.net.message.TransferContent;

public class textClient extends Thread {

	private final String host;

	private final String username;

	private final String password;

	private final String character;

	private final String port;

	private static boolean showWorld;

	private final Map&lt;RPObject.ID, RPObject&gt; world_objects;

	private final marauroa.client.ClientFramework clientManager;

	private final PerceptionHandler handler;

	public textClient(final String h, final String u, final String p, final String c, final String P,
<span class="nc" id="L47">			final boolean t) {</span>
<span class="nc" id="L48">		host = h;</span>
<span class="nc" id="L49">		username = u;</span>
<span class="nc" id="L50">		password = p;</span>
<span class="nc" id="L51">		character = c;</span>
<span class="nc" id="L52">		port = P;</span>

<span class="nc" id="L54">		world_objects = new HashMap&lt;RPObject.ID, RPObject&gt;();</span>

<span class="nc" id="L56">		handler = new PerceptionHandler(new IPerceptionListener() {</span>

			@Override
			public boolean onAdded(final RPObject object) {
<span class="nc" id="L60">				return false;</span>
			}

			@Override
			public boolean onClear() {
<span class="nc" id="L65">				return false;</span>
			}

			@Override
			public boolean onDeleted(final RPObject object) {
<span class="nc" id="L70">				return false;</span>
			}

			@Override
			public void onException(final Exception exception,
					final MessageS2CPerception perception) {
<span class="nc" id="L76">				exception.printStackTrace();</span>
<span class="nc" id="L77">			}</span>

			@Override
			public boolean onModifiedAdded(final RPObject object, final RPObject changes) {
<span class="nc" id="L81">				return false;</span>
			}

			@Override
			public boolean onModifiedDeleted(final RPObject object, final RPObject changes) {
<span class="nc" id="L86">				return false;</span>
			}

			@Override
			public boolean onMyRPObject(final RPObject added, final RPObject deleted) {
<span class="nc" id="L91">				return false;</span>
			}

			@Override
			public void onPerceptionBegin(final byte type, final int timestamp) {
<span class="nc" id="L96">			}</span>

			@Override
			public void onPerceptionEnd(final byte type, final int timestamp) {
<span class="nc" id="L100">			}</span>

			@Override
			public void onSynced() {
<span class="nc" id="L104">			}</span>

			@Override
			public void onUnsynced() {
<span class="nc" id="L108">			}</span>
		});

<span class="nc" id="L111">		clientManager = new marauroa.client.ClientFramework(</span>
<span class="nc" id="L112">				&quot;games/stendhal/log4j.properties&quot;) {</span>

			@Override
			protected String getGameName() {
<span class="nc" id="L116">				return &quot;stendhal&quot;;</span>
			}

			@Override
			protected String getVersionNumber() {
<span class="nc" id="L121">				return stendhal.VERSION;</span>
			}

			@Override
			protected void onPerception(final MessageS2CPerception message) {
				try {
<span class="nc" id="L127">					System.out.println(&quot;Received perception &quot;</span>
							+ message.getPerceptionTimestamp());

<span class="nc" id="L130">					handler.apply(message, world_objects);</span>
<span class="nc" id="L131">					final int i = message.getPerceptionTimestamp();</span>

<span class="nc" id="L133">					final RPAction action = new RPAction();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">					if (i % 50 == 0) {</span>
<span class="nc" id="L135">						action.put(&quot;type&quot;, &quot;move&quot;);</span>
<span class="nc" id="L136">						action.put(&quot;dy&quot;, &quot;-1&quot;);</span>
<span class="nc" id="L137">						clientManager.send(action);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">					} else if (i % 50 == 20) {</span>
<span class="nc" id="L139">						action.put(&quot;type&quot;, &quot;move&quot;);</span>
<span class="nc" id="L140">						action.put(&quot;dy&quot;, &quot;1&quot;);</span>
<span class="nc" id="L141">						clientManager.send(action);</span>
					}
<span class="nc bnc" id="L143" title="All 2 branches missed.">					if (showWorld) {</span>
<span class="nc" id="L144">						System.out.println(&quot;&lt;World contents -------------------------------------&gt;&quot;);</span>
<span class="nc" id="L145">						int j = 0;</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">						for (final RPObject object : world_objects.values()) {</span>
<span class="nc" id="L147">							j++;</span>
<span class="nc" id="L148">							System.out.println(j + &quot;. &quot; + object);</span>
<span class="nc" id="L149">						}</span>
<span class="nc" id="L150">						System.out.println(&quot;&lt;/World contents -------------------------------------&gt;&quot;);</span>
					}
<span class="nc" id="L152">				} catch (final Exception e) {</span>
<span class="nc" id="L153">					e.printStackTrace();</span>
<span class="nc" id="L154">				}</span>
<span class="nc" id="L155">			}</span>

			@Override
			protected List&lt;TransferContent&gt; onTransferREQ(
					final List&lt;TransferContent&gt; items) {
<span class="nc bnc" id="L160" title="All 2 branches missed.">				for (final TransferContent item : items) {</span>
<span class="nc" id="L161">					item.ack = true;</span>
<span class="nc" id="L162">				}</span>

<span class="nc" id="L164">				return items;</span>
			}

			@Override
			protected void onTransfer(final List&lt;TransferContent&gt; items) {
<span class="nc" id="L169">				System.out.println(&quot;Transfering ----&quot;);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">				for (final TransferContent item : items) {</span>
<span class="nc" id="L171">					System.out.println(item);</span>
<span class="nc" id="L172">				}</span>
<span class="nc" id="L173">			}</span>

			@Override
			protected void onAvailableCharacters(final String[] characters) {
<span class="nc" id="L177">				System.out.println(&quot;Characters available&quot;);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">				for (final String characterAvail : characters) {</span>
<span class="nc" id="L179">					System.out.println(characterAvail);</span>
				}

				try {
<span class="nc" id="L183">					chooseCharacter(character);</span>
<span class="nc" id="L184">				} catch (final Exception e) {</span>
<span class="nc" id="L185">					e.printStackTrace();</span>
<span class="nc" id="L186">				}</span>
<span class="nc" id="L187">			}</span>

			@Override
			protected void onServerInfo(final String[] info) {
<span class="nc" id="L191">				System.out.println(&quot;Server info&quot;);</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">				for (final String info_string : info) {</span>
<span class="nc" id="L193">					System.out.println(info_string);</span>
				}
<span class="nc" id="L195">			}</span>

			@Override
			protected void onPreviousLogins(final List&lt;String&gt; previousLogins) {
<span class="nc" id="L199">				System.out.println(&quot;Previous logins&quot;);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">				for (final String info_string : previousLogins) {</span>
<span class="nc" id="L201">					System.out.println(info_string);</span>
<span class="nc" id="L202">				}</span>
<span class="nc" id="L203">			}</span>
		};

<span class="nc" id="L206">	}</span>

	@Override
	public void run() {
		try {
<span class="nc" id="L211">			clientManager.connect(host, Integer.parseInt(port));</span>
<span class="nc" id="L212">			clientManager.login(username, password);</span>
<span class="nc" id="L213">		} catch (final Exception e) {</span>
<span class="nc" id="L214">			e.printStackTrace();</span>
<span class="nc" id="L215">			return;</span>
<span class="nc" id="L216">		}</span>

		final boolean cond = true;

		while (cond) {
<span class="nc" id="L221">			clientManager.loop(0);</span>
			try {
<span class="nc" id="L223">				sleep(100);</span>
<span class="nc" id="L224">			} catch (final InterruptedException e) {</span>
<span class="nc" id="L225">			}</span>
		}
	}

	public static void main(final String[] args) {
		try {
<span class="nc bnc" id="L231" title="All 2 branches missed.">			if (args.length &gt; 0) {</span>
<span class="nc" id="L232">				int i = 0;</span>
<span class="nc" id="L233">				String username = null;</span>
<span class="nc" id="L234">				String password = null;</span>
<span class="nc" id="L235">				String character = null;</span>
<span class="nc" id="L236">				String host = null;</span>
<span class="nc" id="L237">				String port = null;</span>
<span class="nc" id="L238">				boolean tcp = false;</span>

<span class="nc bnc" id="L240" title="All 2 branches missed.">				while (i != args.length) {</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">					if (args[i].equals(&quot;-u&quot;)) {</span>
<span class="nc" id="L242">						username = args[i + 1];</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">					} else if (args[i].equals(&quot;-p&quot;)) {</span>
<span class="nc" id="L244">						password = args[i + 1];</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">					} else if (args[i].equals(&quot;-c&quot;)) {</span>
<span class="nc" id="L246">						character = args[i + 1];</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">					} else if (args[i].equals(&quot;-h&quot;)) {</span>
<span class="nc" id="L248">						host = args[i + 1];</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">					} else if (args[i].equals(&quot;-P&quot;)) {</span>
<span class="nc" id="L250">						port = args[i + 1];</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">					} else if (args[i].equals(&quot;-W&quot;)) {</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">						if (&quot;1&quot;.equals(args[i + 1])) {</span>
<span class="nc" id="L253">							showWorld = true;</span>
						}
<span class="nc bnc" id="L255" title="All 2 branches missed.">					} else if (args[i].equals(&quot;-t&quot;)) {</span>
<span class="nc" id="L256">						tcp = true;</span>
					}
<span class="nc" id="L258">					i++;</span>
				}

<span class="nc bnc" id="L261" title="All 10 branches missed.">				if ((username != null) &amp;&amp; (password != null)</span>
						&amp;&amp; (character != null) &amp;&amp; (host != null)
						&amp;&amp; (port != null)) {
<span class="nc" id="L264">					System.out.println(&quot;Parameter operation&quot;);</span>
<span class="nc" id="L265">					new textClient(host, username, password, character, port,</span>
							tcp).start();
<span class="nc" id="L267">					return;</span>
				}
			}

<span class="nc" id="L271">			System.out.println(&quot;Stendhal textClient&quot;);</span>
<span class="nc" id="L272">			System.out.println();</span>
<span class="nc" id="L273">			System.out.println(&quot;  games.stendhal.textClient -u username -p pass -h host -P port -c character&quot;);</span>
<span class="nc" id="L274">			System.out.println();</span>
<span class="nc" id="L275">			System.out.println(&quot;Required parameters&quot;);</span>
<span class="nc" id="L276">			System.out.println(&quot;* -h\tHost that is running Marauroa server&quot;);</span>
<span class="nc" id="L277">			System.out.println(&quot;* -P\tPort on which Marauroa server is running&quot;);</span>
<span class="nc" id="L278">			System.out.println(&quot;* -u\tUsername to log into Marauroa server&quot;);</span>
<span class="nc" id="L279">			System.out.println(&quot;* -p\tPassword to log into Marauroa server&quot;);</span>
<span class="nc" id="L280">			System.out.println(&quot;* -c\tCharacter used to log into Marauroa server&quot;);</span>
<span class="nc" id="L281">			System.out.println(&quot;Optional parameters&quot;);</span>
<span class="nc" id="L282">			System.out.println(&quot;* -W\tShow world content? 0 or 1&quot;);</span>
<span class="nc" id="L283">		} catch (final Exception e) {</span>
<span class="nc" id="L284">			e.printStackTrace();</span>
<span class="nc" id="L285">			System.exit(1);</span>
<span class="nc" id="L286">		}</span>
<span class="nc" id="L287">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>