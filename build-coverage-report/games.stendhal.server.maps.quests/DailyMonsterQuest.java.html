<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DailyMonsterQuest.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.maps.quests</a> &gt; <span class="el_source">DailyMonsterQuest.java</span></div><h1>DailyMonsterQuest.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2011 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.server.maps.quests;

import games.stendhal.common.MathHelper;
import games.stendhal.common.grammar.Grammar;
import games.stendhal.common.parser.Sentence;
import games.stendhal.server.core.engine.SingletonRepository;
import games.stendhal.server.entity.creature.Creature;
import games.stendhal.server.entity.creature.LevelBasedComparator;
import games.stendhal.server.entity.npc.ChatAction;
import games.stendhal.server.entity.npc.ConversationPhrases;
import games.stendhal.server.entity.npc.ConversationStates;
import games.stendhal.server.entity.npc.EventRaiser;
import games.stendhal.server.entity.npc.SpeakerNPC;
import games.stendhal.server.entity.npc.action.IncreaseKarmaAction;
import games.stendhal.server.entity.npc.action.IncreaseXPDependentOnLevelAction;
import games.stendhal.server.entity.npc.action.IncrementQuestAction;
import games.stendhal.server.entity.npc.action.MultipleActions;
import games.stendhal.server.entity.npc.action.SayTimeRemainingAction;
import games.stendhal.server.entity.npc.action.SetQuestAction;
import games.stendhal.server.entity.npc.action.SetQuestToTimeStampAction;
import games.stendhal.server.entity.npc.condition.AndCondition;
import games.stendhal.server.entity.npc.condition.KilledForQuestCondition;
import games.stendhal.server.entity.npc.condition.NotCondition;
import games.stendhal.server.entity.npc.condition.OrCondition;
import games.stendhal.server.entity.npc.condition.QuestCompletedCondition;
import games.stendhal.server.entity.npc.condition.QuestNotCompletedCondition;
import games.stendhal.server.entity.npc.condition.QuestNotStartedCondition;
import games.stendhal.server.entity.npc.condition.QuestStartedCondition;
import games.stendhal.server.entity.npc.condition.TimePassedCondition;
import games.stendhal.server.entity.player.Player;
import games.stendhal.server.maps.Region;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.LinkedList;
import java.util.List;
import java.util.Random;

import org.apache.log4j.Logger;

/**
 * QUEST: Daily Monster Kill Quest.
 * &lt;p&gt;
 * PARTICIPANTS:
 * &lt;li&gt; Mayor
 * &lt;li&gt; some creatures
 * &lt;p&gt;
 * STEPS:
 * &lt;li&gt; talk to Mayor to get a quest to kill one of a named creature class
 * &lt;li&gt; kill one creature of that class
 * &lt;li&gt; tell Mayor that you are done
 * &lt;li&gt; if after 7 days you were not able to kill the creature, you have an
 * option to get another quest
 * &lt;p&gt;
 * REWARD: - xp - 5 karma
 * &lt;p&gt;
 * REPETITIONS: - once a day
 */

public class DailyMonsterQuest extends AbstractQuest {

	private static final String QUEST_SLOT = &quot;daily&quot;;
<span class="fc" id="L77">	private final SpeakerNPC npc = npcs.get(&quot;Mayor Sakhs&quot;);</span>
<span class="fc" id="L78">	private static Logger logger = Logger.getLogger(&quot;DailyMonsterQuest&quot;);</span>

	private final static int delay = MathHelper.MINUTES_IN_ONE_DAY;
	private final static int expireDelay = MathHelper.MINUTES_IN_ONE_WEEK;

	
	/** All creatures, sorted by level. */
	private static List&lt;Creature&gt; sortedcreatures;	
	
	private static void refreshCreaturesList(final String excludedCreature) {
<span class="fc" id="L88">		final Collection&lt;Creature&gt; creatures = SingletonRepository.getEntityManager().getCreatures();</span>
<span class="fc" id="L89">		sortedcreatures = new LinkedList&lt;Creature&gt;();</span>
<span class="fc bfc" id="L90" title="All 2 branches covered.">		for (Creature creature : creatures) {</span>
<span class="pc bpc" id="L91" title="1 of 4 branches missed.">			if (!creature.isRare() &amp;&amp; !creature.getName().equals(excludedCreature)) {</span>
<span class="fc" id="L92">				sortedcreatures.add(creature);</span>
			}
<span class="fc" id="L94">		}</span>
<span class="fc" id="L95">		Collections.sort(sortedcreatures, new LevelBasedComparator());</span>
<span class="fc" id="L96">	}	</span>
	
	/**
	 * constructor for quest
	 */
<span class="fc" id="L101">	public DailyMonsterQuest() {</span>
<span class="fc" id="L102">		refreshCreaturesList(null);</span>
<span class="fc" id="L103">	}</span>
	
<span class="fc" id="L105">	static class DailyQuestAction implements ChatAction {</span>
		//private String debugString;
		
		@Override
		public void fire(final Player player, final Sentence sentence, final EventRaiser raiser) {

<span class="nc" id="L111">			final String questInfo = player.getQuest(QUEST_SLOT);</span>
<span class="nc" id="L112">			String questCount = null;</span>
<span class="nc" id="L113">			String questLast = null;</span>
			
<span class="nc" id="L115">            String previousCreature = null;</span>
            
<span class="nc bnc" id="L117" title="All 2 branches missed.">			if (questInfo != null) {</span>
<span class="nc" id="L118">				final String[] tokens = (questInfo + &quot;;0;0;0&quot;).split(&quot;;&quot;);</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">				if(!&quot;done&quot;.equals(tokens[0])) {</span>
					// can't use this method because this class is static
					// previousCreature = getCreatureToKillFromPlayer(player);
<span class="nc" id="L122">					String[] split = tokens[0].split(&quot;,&quot;);</span>
<span class="nc" id="L123">					previousCreature = split[0];</span>
				}
				//questLast = tokens[1];
<span class="nc" id="L126">				questCount = tokens[2];</span>
			}
			
<span class="nc" id="L129">			refreshCreaturesList(previousCreature);</span>
			
			// Creature selection magic happens here
<span class="nc" id="L132">			final Creature pickedCreature = pickIdealCreature(player.getLevel(),</span>
					false, sortedcreatures);

			// shouldn't happen
<span class="nc bnc" id="L136" title="All 2 branches missed.">			if (pickedCreature == null) {</span>
<span class="nc" id="L137">				raiser.say(&quot;Thanks for asking, but there's nothing you can do for me now.&quot;);</span>
<span class="nc" id="L138">				return;</span>
			}

<span class="nc" id="L141">			String creatureName = pickedCreature.getName();</span>
			
			
<span class="nc" id="L144">			raiser.say(&quot;Semos is in need of help. Go kill &quot; + Grammar.a_nounCreature(creatureName)</span>
					+ &quot; and say #complete, once you're done.&quot;);

<span class="nc" id="L147">			questLast = &quot;&quot; + new Date().getTime();</span>
<span class="nc" id="L148">			player.setQuest(</span>
					QUEST_SLOT, 
					creatureName + &quot;,0,1,&quot;+
					player.getSoloKill(creatureName)+&quot;,&quot;+
					player.getSharedKill(creatureName)+&quot;;&quot; + 
					questLast + &quot;;&quot;+ 
					questCount);
<span class="nc" id="L155">		}</span>

		// Returns a random creature near the players level, returns null if
		// there is a bug.
		// The ability to set a different level is for testing purposes
		public Creature pickIdealCreature(final int level, final boolean testMode, final List&lt;Creature&gt; creatureList) {
			// int level = player.getLevel();

			// start = lower bound, current = upper bound, for the range of
			// acceptable monsters for this specific player
<span class="fc" id="L165">			int current = -1;</span>
<span class="fc" id="L166">			int start = 0;</span>

<span class="fc" id="L168">			boolean lowerBoundIsSet = false;</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">			for (final Creature creature : creatureList) {</span>
<span class="fc" id="L170">				current++;</span>
				// Set the strongest creature
<span class="fc bfc" id="L172" title="All 2 branches covered.">				if (creature.getLevel() &gt; level + 5) {</span>
<span class="fc" id="L173">					current--;</span>
<span class="fc" id="L174">					break;</span>
				}
				// Set the weakest creature
<span class="fc bfc" id="L177" title="All 6 branches covered.">				if (!lowerBoundIsSet &amp;&amp; creature.getLevel() &gt; 0</span>
						&amp;&amp; creature.getLevel() &gt;= level - 5) {
<span class="fc" id="L179">					start = current;</span>
<span class="fc" id="L180">					lowerBoundIsSet = true;</span>
				}
<span class="fc" id="L182">			}</span>

			// possible with low lvl player and no low lvl creatures.
<span class="fc bfc" id="L185" title="All 2 branches covered.">			if (current &lt; 0) {</span>
<span class="fc" id="L186">				current = 0;</span>
			}

			// possible if the player is ~5 levels higher than the highest level
			// creature
<span class="fc bfc" id="L191" title="All 2 branches covered.">			if (!lowerBoundIsSet) {</span>
<span class="fc" id="L192">				start = current;</span>
			}

			// make sure the pool of acceptable monsters is at least
			// minSelected, the additional creatures will be weaker
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">			if (current &gt;= start) {</span>
				final int minSelected = 5;
<span class="fc" id="L199">				final int numSelected = current - start + 1;</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">				if (numSelected &lt; minSelected) {</span>
<span class="fc" id="L201">					start = start - (minSelected - numSelected);</span>
					// don't let the lower bound go too low
<span class="fc bfc" id="L203" title="All 2 branches covered.">					if (start &lt; 0) {</span>
<span class="fc" id="L204">						start = 0;</span>
					}
				}
			}

			// shouldn't happen
<span class="pc bpc" id="L210" title="2 of 6 branches missed.">			if (current &lt; start || start &lt; 0</span>
					|| current &gt;= creatureList.size()) {
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">				if (testMode) {</span>
<span class="nc" id="L213">					logger.debug(&quot;ERROR: &lt;&quot;+level + &quot;&gt; start=&quot; + start + </span>
							&quot;, current=&quot; + current);
				}
<span class="fc" id="L216">				return null;</span>
			}

			// pick a random creature from the acceptable range.
<span class="fc" id="L220">			final int result = start + new Random().nextInt(current - start + 1);</span>
<span class="fc" id="L221">			final Creature cResult = creatureList.get(result);</span>

<span class="pc bpc" id="L223" title="1 of 2 branches missed.">			if (testMode) {</span>
<span class="nc" id="L224">				logger.debug(&quot;OK: &lt;&quot; + level + &quot;&gt; start=&quot; + start</span>
						+ &quot;, current=&quot; + current + &quot;, result=&quot; + result
						+ &quot;, cResult=&quot; + cResult.getName() + &quot;. OPTIONS: &quot;);
<span class="nc bnc" id="L227" title="All 2 branches missed.">				for (int i = start; i &lt;= current; i++) {</span>
<span class="nc" id="L228">					final Creature cTemp = creatureList.get(i);</span>
<span class="nc" id="L229">					logger.debug(cTemp.getName() + &quot;:&quot; + cTemp.getLevel()	+ &quot;; &quot;);</span>
				}
			}
<span class="fc" id="L232">			return cResult;</span>
		}

		/*
		// Debug Only, Performs tests
		// Populates debugString with test data.
		public void testAllLevels() {
			debugString = &quot;&quot;;
			int max = Level.maxLevel();
			// in case max level is set to infinity in the future.
			if (max &gt; 1100) {
				max = 1100;
			}
			for (int i = 0; i &lt;= max; i++) {
				pickIdealCreature(i, true, sortedcreatures);
			}
		}
		*/
	}	

	@Override
	public String getSlotName() {
<span class="nc" id="L254">		return QUEST_SLOT;</span>
	}
	
	@Override
	public List&lt;String&gt; getHistory(final Player player) {
<span class="nc" id="L259">		final List&lt;String&gt; res = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">		if (!player.hasQuest(QUEST_SLOT)) {</span>
<span class="nc" id="L261">			return res;</span>
		}
<span class="nc" id="L263">		res.add(&quot;I have met Mayor Sakhs in Semos Townhall.&quot;);</span>
<span class="nc" id="L264">		final String questState = player.getQuest(QUEST_SLOT);</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">		if (&quot;rejected&quot;.equals(questState)) {</span>
<span class="nc" id="L266">			res.add(&quot;I do not want to help Semos.&quot;);</span>
<span class="nc" id="L267">			return res;</span>
		}

<span class="nc" id="L270">		res.add(&quot;I want to help Semos.&quot;);</span>
<span class="nc bnc" id="L271" title="All 4 branches missed.">		if (player.hasQuest(QUEST_SLOT) &amp;&amp; !player.isQuestCompleted(QUEST_SLOT)) {</span>
<span class="nc" id="L272">			final boolean questDone = new KilledForQuestCondition(QUEST_SLOT, 0)</span>
					.fire(player, null, null);
<span class="nc" id="L274">			final String creatureToKill = getCreatureToKillFromPlayer(player);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">			if (!questDone) {</span>
<span class="nc" id="L276">				res.add(&quot;I have been asked to kill &quot; + Grammar.a_nounCreature(creatureToKill)</span>
						+ &quot; to help Semos. I haven't killed it yet.&quot;);
			} else {
<span class="nc" id="L279">				res.add(&quot;I have killed the &quot; + creatureToKill</span>
						+ &quot; to help Semos.&quot;);
			}
		}
<span class="nc bnc" id="L283" title="All 2 branches missed.">		if (player.isQuestCompleted(QUEST_SLOT)) {</span>
<span class="nc" id="L284">			final String[] tokens = (questState + &quot;;0;0;0&quot;).split(&quot;;&quot;);</span>
<span class="nc" id="L285">			final String questLast = tokens[1];</span>
<span class="nc" id="L286">			final long timeRemaining = Long.parseLong(questLast) + MathHelper.MILLISECONDS_IN_ONE_DAY</span>
					- System.currentTimeMillis();

<span class="nc bnc" id="L289" title="All 2 branches missed.">			if (timeRemaining &gt; 0L) {</span>
<span class="nc" id="L290">				res.add(&quot;I killed the last creature the mayor asked me to kill and claimed my reward within the last 24 hours.&quot;);</span>
			} else {
<span class="nc" id="L292">				res.add(&quot;I killed the last creature the mayor asked me to kill and now Semos needs my help again.&quot;);</span>
			}
		}
		// add to history how often player helped Semos so far
<span class="nc" id="L296">		final int repetitions = player.getNumberOfRepetitions(getSlotName(), 2);</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">		if (repetitions &gt; 0) {</span>
<span class="nc" id="L298">			res.add(&quot;I helped and saved Semos &quot;</span>
					+ Grammar.quantityplnounCreature(repetitions, &quot;time&quot;) + &quot; so far.&quot;);
		}
<span class="nc" id="L301">		return res;</span>
	}
	
	private String getCreatureToKillFromPlayer(Player player) {
<span class="nc" id="L305">		String actualQuestSlot = player.getQuest(QUEST_SLOT, 0);</span>
<span class="nc" id="L306">		String[] split = actualQuestSlot.split(&quot;,&quot;);</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">		if (split.length &gt; 1) {</span>
			// only return object if the slot was in the format expected (i.e. not done;timestamp;count etc)
<span class="nc" id="L309">			return split[0];</span>
		}
<span class="nc" id="L311">		return null;</span>
	}

	/**
	 * player said &quot;quest&quot;
	 */
	private void step_1() {
		// player asking for quest when he have active non-expired quest 
<span class="fc" id="L319">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.QUEST_MESSAGES,
				new AndCondition(
						new NotCondition(
								new OrCondition(
										new QuestNotStartedCondition(QUEST_SLOT),
										new QuestCompletedCondition(QUEST_SLOT))),
						new NotCondition(
								new TimePassedCondition(QUEST_SLOT, 1, expireDelay))), 
				ConversationStates.ATTENDING, 
				null,
<span class="fc" id="L330">				new ChatAction() {</span>
					@Override
					public void fire(Player player, Sentence sentence, EventRaiser npc) {
<span class="nc" id="L333">						npc.say(&quot;You're already on a quest to slay &quot; + </span>
								Grammar.a_nounCreature(player.getQuest(QUEST_SLOT,0).split(&quot;,&quot;)[0]) + 
								&quot;. Say #complete if you're done with it!&quot;);
<span class="nc" id="L336">					}			</span>
				});
		
		// player have expired quest time
<span class="fc" id="L340">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.QUEST_MESSAGES,
				new AndCondition(
						new NotCondition(
								new OrCondition(
										new QuestNotStartedCondition(QUEST_SLOT),
										new QuestCompletedCondition(QUEST_SLOT))),
						new TimePassedCondition(QUEST_SLOT, 1, expireDelay)), 
				ConversationStates.ATTENDING, 
				null,
<span class="fc" id="L350">				new ChatAction() {</span>
					@Override
					public void fire(Player player, Sentence sentence, EventRaiser npc) {
<span class="nc bnc" id="L353" title="All 2 branches missed.">						if(player.getQuest(QUEST_SLOT, 0)!=null) {</span>
<span class="nc" id="L354">								npc.say(&quot;You're already on a quest to slay &quot; + </span>
										Grammar.a_nounCreature(player.getQuest(QUEST_SLOT, 0).split(&quot;,&quot;)[0]) + 
										&quot;. Say #complete if you're done with it!&quot; +
										&quot; If you can't find one, perhaps it won't bother Semos either. You could kill #another creature if you like.&quot;);
						}
<span class="nc" id="L359">					}</span>
				});
		
		// player asking for quest before allowed time interval 
<span class="fc" id="L363">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.QUEST_MESSAGES,
				new AndCondition(
						new QuestCompletedCondition(QUEST_SLOT),
						new NotCondition( 
								new TimePassedCondition(QUEST_SLOT, 1, delay))), 
				ConversationStates.ATTENDING, 
				null,
				new SayTimeRemainingAction(QUEST_SLOT,1, delay, &quot;I can only give you a new quest once a day. Please check back in&quot;));

		// player asked for quest first time or repeat it after passed proper time
<span class="fc" id="L374">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.QUEST_MESSAGES,
				new OrCondition(
						new QuestNotStartedCondition(QUEST_SLOT),
						new AndCondition(
								new QuestCompletedCondition(QUEST_SLOT),
								new TimePassedCondition(QUEST_SLOT, 1, delay))), 
				ConversationStates.ATTENDING, 
				null,
				new DailyQuestAction());		
<span class="fc" id="L384">	}</span>

	/**
	 * player killing monster
	 */
	private void step_2() {
		// kill the monster
<span class="fc" id="L391">	}</span>

	/**
	 * player said &quot;done&quot;
	 */
	private void step_3() {
		// player never asked for this quest
<span class="fc" id="L398">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.FINISH_MESSAGES,
				new QuestNotStartedCondition(QUEST_SLOT),
				ConversationStates.ATTENDING, 
				&quot;I'm afraid I didn't send you on a #quest yet.&quot;,
				null);

		// player already completed this quest
<span class="fc" id="L406">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.FINISH_MESSAGES,
				new QuestCompletedCondition(QUEST_SLOT),
				ConversationStates.ATTENDING, 
				&quot;You already completed the last quest I had given to you.&quot;,
				null);

		// player didn't killed creature 
<span class="fc" id="L414">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.FINISH_MESSAGES,
				new AndCondition(
						new QuestStartedCondition(QUEST_SLOT),
						new QuestNotCompletedCondition(QUEST_SLOT),
						new NotCondition(
						        new KilledForQuestCondition(QUEST_SLOT, 0))),
				ConversationStates.ATTENDING, 
				null,
<span class="fc" id="L423">				new ChatAction() {</span>
					@Override
					public void fire(Player player, Sentence sentence, EventRaiser npc) {
<span class="nc" id="L426">							final String questKill = player.getQuest(QUEST_SLOT, 0).split(&quot;,&quot;)[0];</span>
<span class="nc" id="L427">							npc.say(&quot;You didn't kill &quot; + Grammar.a_nounCreature(questKill)</span>
									+ &quot; yet. Go and do it and say #complete only after you're done.&quot;);							
<span class="nc" id="L429">					}</span>
				});

		// player killed creature
<span class="fc" id="L433">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.FINISH_MESSAGES,
				new AndCondition(
						new QuestStartedCondition(QUEST_SLOT),
						new QuestNotCompletedCondition(QUEST_SLOT),
				        new KilledForQuestCondition(QUEST_SLOT, 0)),
				ConversationStates.ATTENDING, 
				&quot;Good work! Let me thank you in the name of the people of Semos!&quot;,
				new MultipleActions(
						new IncreaseXPDependentOnLevelAction(5, 95.0),
						new IncreaseKarmaAction(5.0),
						new IncrementQuestAction(QUEST_SLOT, 2, 1),
						new SetQuestToTimeStampAction(QUEST_SLOT,1),
						new SetQuestAction(QUEST_SLOT,0,&quot;done&quot;)
		));
<span class="fc" id="L448">	}</span>

	/**
	 * player said &quot;another&quot;
	 */
	private void step_4() {
		// player have no active quest and trying to get another
<span class="fc" id="L455">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.ABORT_MESSAGES, 
				new OrCondition(
						new QuestNotStartedCondition(QUEST_SLOT),
						new QuestCompletedCondition(QUEST_SLOT)),
				ConversationStates.ATTENDING, 
				&quot;I'm afraid I didn't send you on a #quest yet.&quot;, 
				null);
		
		// player have no expired quest 
<span class="fc" id="L465">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.ABORT_MESSAGES, 
				new NotCondition( 
						new TimePassedCondition(QUEST_SLOT, 1, expireDelay)),
				ConversationStates.ATTENDING, 
				&quot;It hasn't been long since you've started your quest, I won't let you give up so soon.&quot;, 
				null);
		
		// player have expired quest
<span class="fc" id="L474">		npc.add(ConversationStates.ATTENDING,</span>
				ConversationPhrases.ABORT_MESSAGES, 
				new TimePassedCondition(QUEST_SLOT, 1, expireDelay),
				ConversationStates.ATTENDING, 
				null, 
				new DailyQuestAction());
<span class="fc" id="L480">	}</span>

	@Override
	public void addToWorld() {
<span class="fc" id="L484">		fillQuestInfo(</span>
				&quot;Daily Monster Quest&quot;,
				&quot;Mayor Sakhs needs warriors to keep Semos city safe.&quot;,
				true);
<span class="fc" id="L488">		step_1();</span>
<span class="fc" id="L489">		step_2();</span>
<span class="fc" id="L490">		step_3();</span>
<span class="fc" id="L491">		step_4();</span>
<span class="fc" id="L492">	}</span>

	@Override
	public String getName() {
<span class="nc" id="L496">		return &quot;DailyMonsterQuest&quot;;</span>
	}
	
	@Override
	public int getMinLevel() {
<span class="fc" id="L501">		return 0;</span>
	}

	@Override
	public boolean isRepeatable(final Player player) {
<span class="nc" id="L506">		return	new AndCondition(new QuestCompletedCondition(QUEST_SLOT),</span>
						 new TimePassedCondition(QUEST_SLOT,1,delay)).fire(player, null, null);
	}

	@Override
	public String getRegion() {
<span class="nc" id="L512">		return Region.SEMOS_CITY;</span>
	}

	@Override
	public String getNPCName() {
<span class="nc" id="L517">		return &quot;Mayor Sakhs&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>