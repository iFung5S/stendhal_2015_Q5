<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>EasterGiftsForChildren.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.maps.quests</a> &gt; <span class="el_source">EasterGiftsForChildren.java</span></div><h1>EasterGiftsForChildren.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2011 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.server.maps.quests;

import games.stendhal.server.entity.npc.ChatAction;
import games.stendhal.server.entity.npc.ConversationPhrases;
import games.stendhal.server.entity.npc.ConversationStates;
import games.stendhal.server.entity.npc.SpeakerNPC;
import games.stendhal.server.entity.npc.action.DropItemAction;
import games.stendhal.server.entity.npc.action.EquipItemAction;
import games.stendhal.server.entity.npc.action.IncreaseKarmaAction;
import games.stendhal.server.entity.npc.action.IncreaseXPAction;
import games.stendhal.server.entity.npc.action.MultipleActions;
import games.stendhal.server.entity.npc.action.SetQuestAction;
import games.stendhal.server.entity.npc.action.SetQuestAndModifyKarmaAction;
import games.stendhal.server.entity.npc.condition.AndCondition;
import games.stendhal.server.entity.npc.condition.GreetingMatchesNameCondition;
import games.stendhal.server.entity.npc.condition.NotCondition;
import games.stendhal.server.entity.npc.condition.PlayerHasItemWithHimCondition;
import games.stendhal.server.entity.npc.condition.QuestActiveCondition;
import games.stendhal.server.entity.npc.condition.QuestCompletedCondition;
import games.stendhal.server.entity.npc.condition.QuestInStateCondition;
import games.stendhal.server.entity.npc.condition.QuestNotCompletedCondition;
import games.stendhal.server.entity.player.Player;
import games.stendhal.server.maps.Region;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

/**
 * QUEST: Easter gifts for children
 *
 * PARTICIPANTS:
 * &lt;ul&gt;
 * &lt;li&gt;Caroline who is working in her tavern in Ados city&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * STEPS:
 * &lt;ul&gt;
 * &lt;li&gt;Caroline wants to make children around Faiumoni happy with gifting easter baskets for them.&lt;/li&gt;
 * &lt;li&gt;Players have to bring Caroline sweets like chocolate bars and chocolate eggs, as well as some fruit.&lt;/li&gt;
 * &lt;li&gt;Children around Faiumoni will be happy with Carolines baskets.&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * REWARD:
 * &lt;ul&gt;
 * &lt;li&gt;100 XP&lt;/li&gt;
 * &lt;li&gt;5 Ados city scrolls&lt;/li&gt;
 * &lt;li&gt;2 home scrolls&lt;/li&gt;
 * &lt;li&gt;Karma: 50&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * REPETITIONS:
 * &lt;ul&gt;
 * &lt;li&gt;None&lt;/li&gt;
 * &lt;/ul&gt;
 */
<span class="nc" id="L70">public class EasterGiftsForChildren extends AbstractQuest {</span>

	private static final String QUEST_SLOT = &quot;easter_gifts_[year]&quot;;

	

	@Override
	public List&lt;String&gt; getHistory(final Player player) {
<span class="nc" id="L78">		final List&lt;String&gt; res = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">		if (!player.hasQuest(QUEST_SLOT)) {</span>
<span class="nc" id="L80">			return res;</span>
		}
<span class="nc" id="L82">		res.add(&quot;I talked to Caroline in Ados. She is working in her tavern there.&quot;);</span>
<span class="nc" id="L83">		final String questState = player.getQuest(QUEST_SLOT);</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">		if (&quot;rejected&quot;.equals(questState)) {</span>
<span class="nc" id="L85">			res.add(&quot;She asked me to bring her some sweets but I rejected her request.&quot;);</span>
		}
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if (player.isQuestInState(QUEST_SLOT, &quot;start&quot;, &quot;done&quot;)) {</span>
<span class="nc" id="L88">			res.add(&quot;I promised to bring Caroline some sweets for children around Faiumoni as an Easter gift.&quot;);</span>
		}
<span class="nc bnc" id="L90" title="All 12 branches missed.">		if (&quot;start&quot;.equals(questState) &amp;&amp; player.isEquipped(&quot;chocolate bar&quot;, 5)  &amp;&amp; player.isEquipped(&quot;small easter egg&quot;, 1) &amp;&amp; player.isEquipped(&quot;apple&quot;, 5)  &amp;&amp; player.isEquipped(&quot;cherry&quot;, 5) || &quot;done&quot;.equals(questState)) {</span>
<span class="nc" id="L91">			res.add(&quot;I got all the sweets and will take them to Caroline.&quot;);</span>
		}
<span class="nc bnc" id="L93" title="All 2 branches missed.">		if (&quot;done&quot;.equals(questState)) {</span>
<span class="nc" id="L94">			res.add(&quot;I took the sweets to Caroline. She gave me some nice Easter gifts for my travels as a real hero. :)&quot;);</span>
		}
<span class="nc" id="L96">		return res;</span>
	}

	private void prepareRequestingStep() {
<span class="nc" id="L100">		final SpeakerNPC npc = npcs.get(&quot;Caroline&quot;);</span>

<span class="nc" id="L102">		npc.add(</span>
			ConversationStates.ATTENDING,
			ConversationPhrases.QUEST_MESSAGES,
			new QuestNotCompletedCondition(QUEST_SLOT),
			ConversationStates.QUEST_OFFERED, 
			&quot;I need some help with packing Easter baskets for children around Faiumoni. I know that the bunny will meet them, but they are so lovely that I want to make them happy, too. Do you think you can help me?&quot;,
			null);

<span class="nc" id="L110">		npc.add(</span>
			ConversationStates.ATTENDING,
			ConversationPhrases.QUEST_MESSAGES,
			new QuestCompletedCondition(QUEST_SLOT),
			ConversationStates.ATTENDING, 
			&quot;Thank you very much for the sweets! I already gave all Easter baskets away to children around Faiumoni and they were really happy! :) Unfortunately I don't have any other task for you at the moment. Have wonderful Easter holidays!&quot;,
			null);
		
		// Player asks for quests after it is already started
<span class="nc" id="L119">		npc.add(</span>
			ConversationStates.ATTENDING,
			ConversationPhrases.QUEST_MESSAGES,
			new QuestActiveCondition(QUEST_SLOT),
			ConversationStates.ATTENDING,
			&quot;Did you forget? I already asked you to fetch me some #sweets&quot;,
			null);

		// player is willing to help
<span class="nc" id="L128">		npc.add(</span>
			ConversationStates.QUEST_OFFERED,
			ConversationPhrases.YES_MESSAGES,
			null,
			ConversationStates.ATTENDING,
			&quot;I need some #sweets for my Easter baskets. If you get 5 #chocolate #bars, a #small #easter #egg, 5 #apples and 5 #cherries, I'll give you a nice Easter reward.&quot;,
			new SetQuestAction(QUEST_SLOT, &quot;start&quot;));

		// player is not willing to help
<span class="nc" id="L137">		npc.add(</span>
			ConversationStates.QUEST_OFFERED,
			ConversationPhrases.NO_MESSAGES, null,
			ConversationStates.ATTENDING,
			&quot;Oh what a pity! Poor children will not receive wonderful baskets then. Maybe I'll find someone else and ask him or her for help.&quot;,
			new SetQuestAndModifyKarmaAction(QUEST_SLOT, &quot;rejected&quot;, -5.0));

		// player wants to know what sweets she is referring to
<span class="nc" id="L145">		npc.add(</span>
			ConversationStates.ATTENDING,
			Arrays.asList(&quot;sweets&quot;),
			null,
			ConversationStates.ATTENDING,
			&quot;There are lots of chocolate sweets around but I would also like to fill my basket with fruits as well.&quot;, null);
		
		// player wants to know where he can get this sweets from
<span class="nc" id="L153">		npc.add(</span>
				ConversationStates.ATTENDING,
				Arrays.asList(&quot;chocolate bar&quot;, &quot;chocolate bars&quot;, &quot;chocolate&quot;),
				null,
				ConversationStates.ATTENDING,
				&quot;Chocolate bars are sold in taverns and I've heard that some evil children carry them, too. If you find some, remember that Elizabeth in Kirdneh loves chocolate, too. :)&quot;, null);
		
<span class="nc" id="L160">		npc.add(</span>
				ConversationStates.ATTENDING,
				Arrays.asList(&quot;apple&quot;, &quot;apples&quot;),
				null,
				ConversationStates.ATTENDING,
				&quot;Apples are found at the farm to the east of the city. They are really healthy and you can bake an awesome apple pie from these. You can also get one by Martha in Kalavan City gardens.&quot;, null);
		
<span class="nc" id="L167">		npc.add(</span>
				ConversationStates.ATTENDING,
				Arrays.asList(&quot;cherry&quot;, &quot;cherries&quot;),
				null,
				ConversationStates.ATTENDING,
				&quot;Old Mother Helena in Fado sells the most beautifully red cherries. They are really tasty! I hope you tasted the lovely cherry pie already, made by Gertha in Kalavan City gardens.&quot;, null);
		
<span class="nc" id="L174">		npc.add(</span>
				ConversationStates.ATTENDING,
				Arrays.asList(&quot;small easter egg&quot;, &quot;chocolate egg&quot;),
				null,
				ConversationStates.ATTENDING,
				&quot;Small easter eggs are a speciality of our Easter bunny friend who hops around during the Easter days. Maybe you will meet him on his way. :)&quot;, null);
<span class="nc" id="L180">	}</span>

	private void prepareBringingStep() {
<span class="nc" id="L183">		final SpeakerNPC npc = npcs.get(&quot;Caroline&quot;);</span>

		// player returns while quest is still active
<span class="nc" id="L186">		npc.add(ConversationStates.IDLE, ConversationPhrases.GREETING_MESSAGES,</span>
			new AndCondition(new GreetingMatchesNameCondition(npc.getName()),
				new QuestInStateCondition(QUEST_SLOT, &quot;start&quot;),
				new AndCondition(
					new PlayerHasItemWithHimCondition(&quot;chocolate bar&quot;, 5),
					new PlayerHasItemWithHimCondition(&quot;small easter egg&quot;,1),
					new PlayerHasItemWithHimCondition(&quot;apple&quot;, 5),
					new PlayerHasItemWithHimCondition(&quot;cherry&quot;, 5))),
			ConversationStates.QUEST_ITEM_BROUGHT, 
			&quot;Oh nice! I see you have delicious sweets with you. Are they for the Easter baskets which I'm currently preparing?&quot;,
			null);

<span class="nc" id="L198">		npc.add(ConversationStates.IDLE, ConversationPhrases.GREETING_MESSAGES,</span>
			new AndCondition(new GreetingMatchesNameCondition(npc.getName()),
				new QuestInStateCondition(QUEST_SLOT, &quot;start&quot;), 
				new NotCondition(new AndCondition(
					new PlayerHasItemWithHimCondition(&quot;chocolate bar&quot;, 5),
					new PlayerHasItemWithHimCondition(&quot;small easter egg&quot;,1),
					new PlayerHasItemWithHimCondition(&quot;apple&quot;, 5),
					new PlayerHasItemWithHimCondition(&quot;cherry&quot;, 5)))),
			ConversationStates.ATTENDING, 
			&quot;Oh no. There are still some sweets missing which I need for my Easter baskets. Hope you can find them, soon...&quot;,
			null);

<span class="nc" id="L210">		final List&lt;ChatAction&gt; reward = new LinkedList&lt;ChatAction&gt;();</span>
<span class="nc" id="L211">		reward.add(new DropItemAction(&quot;chocolate bar&quot;, 5));</span>
<span class="nc" id="L212">		reward.add(new DropItemAction(&quot;small easter egg&quot;, 1));</span>
<span class="nc" id="L213">		reward.add(new DropItemAction(&quot;apple&quot;, 5));</span>
<span class="nc" id="L214">		reward.add(new DropItemAction(&quot;cherry&quot;,5));</span>
<span class="nc" id="L215">		reward.add(new EquipItemAction(&quot;ados city scroll&quot;, 5));</span>
<span class="nc" id="L216">		reward.add(new EquipItemAction(&quot;home scroll&quot;, 2));</span>
<span class="nc" id="L217">		reward.add(new IncreaseXPAction(100));</span>
<span class="nc" id="L218">		reward.add(new SetQuestAction(QUEST_SLOT, &quot;done&quot;));</span>
<span class="nc" id="L219">		reward.add(new IncreaseKarmaAction(50));</span>
		
		
		
<span class="nc" id="L223">		npc.add(</span>
			ConversationStates.QUEST_ITEM_BROUGHT,
			ConversationPhrases.YES_MESSAGES,
			// make sure the player isn't cheating by putting the sweets
			// away and then saying &quot;yes&quot;
			
			new AndCondition(
					new PlayerHasItemWithHimCondition(&quot;chocolate bar&quot;, 5),
					new PlayerHasItemWithHimCondition(&quot;small easter egg&quot;, 1),
					new PlayerHasItemWithHimCondition(&quot;apple&quot;, 5),
					new PlayerHasItemWithHimCondition(&quot;cherry&quot;, 5)),

			ConversationStates.ATTENDING, &quot;How great! Now I can fill these baskets for the children! They will be so happy! Thank you very much for your help and Happy Easter! Please take these scrolls for your effort. :)&quot;,
			new MultipleActions(reward));


<span class="nc" id="L239">		npc.add(</span>
			ConversationStates.QUEST_ITEM_BROUGHT,
			ConversationPhrases.NO_MESSAGES,
			null,
			ConversationStates.ATTENDING,
			&quot;I hope you'll find some sweets for me before the Easter days passed and children will be sad.&quot;,
			null);
<span class="nc" id="L246">	}</span>

	@Override
	public void addToWorld() {
<span class="nc" id="L250">		fillQuestInfo(</span>
				&quot;Easter Gifts For Children&quot;,
				&quot;Caroline, the nice tavern owner in Ados city, wants to make some children happy during Easter holidays.&quot;,
				false);
<span class="nc" id="L254">		prepareRequestingStep();</span>
<span class="nc" id="L255">		prepareBringingStep();</span>
<span class="nc" id="L256">	}</span>

	@Override
	public String getSlotName() {
<span class="nc" id="L260">		return QUEST_SLOT;</span>
	}

	@Override
	public String getName() {
<span class="nc" id="L265">		return &quot;EasterGiftsForChildren&quot;;</span>
	}
	
	@Override
	public int getMinLevel() {
<span class="nc" id="L270">		return 0;</span>
	}
	
	@Override
	public String getRegion() {
<span class="nc" id="L275">		return Region.ADOS_CITY;</span>
	}
	
	@Override
	public String getNPCName() {
<span class="nc" id="L280">		return &quot;Caroline&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>