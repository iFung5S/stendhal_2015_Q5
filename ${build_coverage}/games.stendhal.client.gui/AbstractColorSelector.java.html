<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AbstractColorSelector.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.client.gui</a> &gt; <span class="el_source">AbstractColorSelector.java</span></div><h1>AbstractColorSelector.java</h1><pre class="source lang-java linenums">/***************************************************************************
 *                   (C) Copyright 2003 - 2015 Faiumoni e.V.               *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.client.gui;

import games.stendhal.client.gui.j2d.Blend;
import games.stendhal.client.gui.layout.SBoxLayout;
import games.stendhal.client.gui.styled.Style;
import games.stendhal.client.gui.styled.StyleUtil;
import games.stendhal.client.sprite.Sprite;
import games.stendhal.client.sprite.SpriteCache;
import games.stendhal.client.sprite.SpriteStore;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Insets;
import java.awt.Point;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;

import javax.swing.JComponent;
import javax.swing.JPanel;
import javax.swing.colorchooser.ColorSelectionModel;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

/**
 * Base class for the outfit color selectors.
 *
 * @param &lt;T&gt; selection model type
 */
public abstract class AbstractColorSelector&lt;T extends ColorSelectionModel&gt; extends JPanel {
	/** Selection model. */
	private final T model;
	
	/**
	 * Construct a selector from a model.
	 * 
	 * @param model selection model
	 */
<span class="nc" id="L51">	AbstractColorSelector(T model) {</span>
<span class="nc" id="L52">		this.model = model;</span>
<span class="nc" id="L53">		setBorder(null);</span>
<span class="nc" id="L54">		setLayout(new SBoxLayout(SBoxLayout.VERTICAL, SBoxLayout.COMMON_PADDING));</span>
<span class="nc" id="L55">	}</span>
	
	/**
	 * Get the selection model.
	 * 
	 * @return selection model
	 */
	T getSelectionModel() {
<span class="nc" id="L63">		return model;</span>
	}
	
	/**
	 * Base class for the color selector sliders.
	 * @param &lt;T&gt; selection model type
	 */
	abstract static class AbstractSelector&lt;T extends ColorSelectionModel&gt; extends JComponent implements ChangeListener {
		/** Model to adjust and listen to. */
		final T model;

		/**
		 * Create a new Selector.
		 * 
		 * @param model selection model
		 */
<span class="nc" id="L79">		AbstractSelector(T model) {</span>
<span class="nc" id="L80">			this.model = model;</span>
<span class="nc" id="L81">			model.addChangeListener(this);</span>
<span class="nc" id="L82">			setOpaque(true);</span>
<span class="nc" id="L83">			applyStyle();</span>
<span class="nc" id="L84">			addMouseMotionListener(new MouseMotionAdapter() {</span>
				@Override
				public void mouseDragged(MouseEvent ev) {
<span class="nc bnc" id="L87" title="All 2 branches missed.">					if (isEnabled()) {</span>
<span class="nc" id="L88">						select(ev.getPoint());</span>
					}
<span class="nc" id="L90">				}</span>
			});

<span class="nc" id="L93">			addMouseListener(new MouseAdapter() {</span>
				@Override
				public void mouseClicked(MouseEvent ev) {
<span class="nc bnc" id="L96" title="All 2 branches missed.">					if (isEnabled()) {</span>
<span class="nc" id="L97">						select(ev.getPoint());</span>
					}
<span class="nc" id="L99">				}</span>
			});
<span class="nc" id="L101">		}</span>

		@Override
		public void stateChanged(ChangeEvent e) {
			// Colors changed
<span class="nc" id="L106">			repaint();</span>
<span class="nc" id="L107">		}</span>

		/**
		 * Apply Stendhal style.
		 */
		private void applyStyle() {
<span class="nc" id="L113">			Style style = StyleUtil.getStyle();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">			if (style != null) {</span>
<span class="nc" id="L115">				setBorder(style.getBorderDown());</span>
			}
<span class="nc" id="L117">		}</span>

		/**
		 * User clicked a point, or dragged the adjuster to it. The component
		 * should recalculate the colors.
		 * 
		 * @param point clicked point
		 */
		abstract void select(Point point);
	}
	
	/**
	 * Base class for color selectors that are based on a sprite.
	 *
	 * @param &lt;T&gt; selection model type
	 */
	abstract static class AbstractSpriteColorSelector&lt;T extends ColorSelectionModel&gt; extends AbstractSelector&lt;T&gt; {
		/** Width of the generated sprite. */
		static final int SPRITE_WIDTH = 80;
		/** Height of the generated sprite. */
		static final int SPRITE_HEIGHT = 52;
		
		/** Background sprites. */
		private Sprite normalSprite, disabledSprite;
		
		/**
		 * Construct a new AbstractSpriteColorSelector.
		 * 
		 * @param model model for the selector
		 */
		AbstractSpriteColorSelector(T model) {
<span class="nc" id="L148">			super(model);</span>
<span class="nc" id="L149">		}</span>
		
		/**
		 * Create the normal, colored background sprite. The dimensions should
		 * be {@link #SPRITE_WIDTH} Ã— {@link #SPRITE_HEIGHT}.
		 * 
		 * @return background sprite
		 */
		abstract Sprite createNormalSprite();
		
		/**
		 * Fetch the normal background sprite.
		 * 
		 * @return colored background sprite
		 */
		private Sprite getNormalSprite() {
<span class="nc bnc" id="L165" title="All 2 branches missed.">			if (normalSprite == null) {</span>
<span class="nc" id="L166">				normalSprite = createNormalSprite();</span>
			}
<span class="nc" id="L168">			return normalSprite;</span>
		}
		
		/**
		 * Get the current background sprite.
		 * 
		 * @return current background
		 */
		Sprite getBackgroundSprite() {
<span class="nc bnc" id="L177" title="All 2 branches missed.">			if (isEnabled()) {</span>
<span class="nc" id="L178">				return getNormalSprite();</span>
			} else {
<span class="nc bnc" id="L180" title="All 2 branches missed.">				if (disabledSprite == null) {</span>
<span class="nc" id="L181">					Sprite orig = getNormalSprite();</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">					if (orig.getReference() != null) {</span>
						// Ensure it's cached so that the automatic lookup for
						// colored version works
<span class="nc" id="L185">						SpriteCache.get().add(orig.getReference(), orig);</span>
<span class="nc" id="L186">						disabledSprite = SpriteStore.get().getColoredSprite(orig.getReference().toString(), Color.GRAY);</span>
					} else {
<span class="nc" id="L188">						disabledSprite = SpriteStore.get().modifySprite(orig, Color.GRAY, Blend.TrueColor, null);</span>
					}
				}
<span class="nc" id="L191">				return disabledSprite;</span>
			}
		}
		
		@Override
		public Dimension getPreferredSize() {
<span class="nc" id="L197">			Sprite s = getBackgroundSprite();</span>
<span class="nc" id="L198">			int width = s.getWidth();</span>
<span class="nc" id="L199">			int height = s.getHeight();</span>
<span class="nc" id="L200">			Insets ins = getInsets();</span>
<span class="nc" id="L201">			width += ins.left + ins.right;</span>
<span class="nc" id="L202">			height += ins.top + ins.bottom;</span>
<span class="nc" id="L203">			return new Dimension(width, height);</span>
		}
		
		@Override
		protected void paintComponent(Graphics g) {
<span class="nc" id="L208">			Insets ins = getInsets();</span>
<span class="nc" id="L209">			Sprite sprite = getBackgroundSprite();</span>
<span class="nc" id="L210">			sprite.draw(g, ins.left, ins.right);</span>
<span class="nc" id="L211">		}</span>
		
		@Override
		public void setEnabled(boolean enabled) {
<span class="nc" id="L215">			boolean old = isEnabled();</span>
<span class="nc" id="L216">			super.setEnabled(enabled);</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">			if (old != enabled) {</span>
<span class="nc" id="L218">				repaint();</span>
			}
<span class="nc" id="L220">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>