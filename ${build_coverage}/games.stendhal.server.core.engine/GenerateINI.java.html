<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GenerateINI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.core.engine</a> &gt; <span class="el_source">GenerateINI.java</span></div><h1>GenerateINI.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2010 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.server.core.engine;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.util.Date;

import marauroa.common.crypto.RSAKey;


/**
 * generates a server.ini for Stendhal
 *
 * @author hendrik
 */
<span class="nc" id="L31">public class GenerateINI {</span>

	/** The name of the output file. */
<span class="nc" id="L34">	private static String filename = &quot;server.ini&quot;;</span>


	/** Where data is read from. */
<span class="nc" id="L38">	private static BufferedReader in = new BufferedReader(</span>
			new InputStreamReader(System.in));
	private static String gameName;

	private static String databaseSystem;

	private static String databaseName;

	private static String databaseHost;

	private static String databaseUsername;

	private static String databasePassword;

	private static String databaseImplementation;

	private static String tcpPort;

	private static String worldImplementation;

	private static String ruleprocessorImplementation;

	private static String turnLength;

	private static String statisticsFilename;

	private static RSAKey rsakey;


	/**
	 * reads a String from the input. When no String is chosen the defaultValue
	 * is used.
	 *
	 * @param input
	 *            the buffered input, usually System.in
	 * @param defaultValue
	 *            if no value is written.
	 * @return the string read or default if none was read.
	 */
	public static String getStringWithDefault(final BufferedReader input,
			final String defaultValue) {
<span class="nc" id="L79">		String ret = &quot;&quot;;</span>
		try {
<span class="nc" id="L81">			ret = input.readLine();</span>
<span class="nc" id="L82">		} catch (final IOException e) {</span>
<span class="nc" id="L83">			e.printStackTrace();</span>
<span class="nc" id="L84">			System.exit(1);</span>
<span class="nc" id="L85">		}</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">		if (ret != null) {</span>
<span class="nc bnc" id="L87" title="All 4 branches missed.">			if ((ret.length() == 0) &amp;&amp; (defaultValue != null)) {</span>
<span class="nc" id="L88">				ret = defaultValue;</span>
			}
		}
<span class="nc" id="L91">		return ret;</span>

	}

	/**
	 * reads a String from the input. When no String is choosen the errorMessage
	 * is is displayed and the application is terminated.
	 *
	 * @param input
	 *            the input stream, usually System.in
	 * @param errorMessage
	 *            the error message to print when failing
	 * @return string read from input
	 */
	public static String getStringWithoutDefault(final BufferedReader input, final String errorMessage) {
<span class="nc" id="L106">		String ret = &quot;&quot;;</span>
		try {
<span class="nc" id="L108">			ret = input.readLine();</span>
<span class="nc" id="L109">		} catch (final IOException e) {</span>
<span class="nc" id="L110">			e.printStackTrace();</span>
<span class="nc" id="L111">			System.exit(1);</span>
<span class="nc" id="L112">		}</span>

<span class="nc bnc" id="L114" title="All 4 branches missed.">		if ((ret == null) || (ret.length() == 0)) {</span>
<span class="nc" id="L115">			System.out.println(errorMessage);</span>
<span class="nc" id="L116">			System.out.println(&quot;Terminating...&quot;);</span>
<span class="nc" id="L117">			System.exit(1);</span>
		}
<span class="nc" id="L119">		return ret;</span>
	}

	/**
	 * Makes the first letter of the source uppercase.
	 *
	 * @param source
	 *            the string
	 * @return *T*he string, with first letter is upper case.
	 */
	public static String uppcaseFirstLetter(final String source) {
<span class="nc bnc" id="L130" title="All 2 branches missed.">		if (source.length() &gt; 0) {</span>
<span class="nc" id="L131">			return Character.toUpperCase(source.charAt(0)) + source.substring(1);</span>
		}
<span class="nc" id="L133">		return source;</span>
	}


	/**
	 * generates a server.ini for Stendhal
	 *
	 * @param args command line parameters
	 * @param serverIni name of server.ini to write
	 * @throws FileNotFoundException in case the file cannot be written
	 */
	public static void main(String[] args, String serverIni) throws FileNotFoundException {
<span class="nc" id="L145">		filename = serverIni;</span>
<span class="nc" id="L146">		main(args);</span>
<span class="nc" id="L147">	}</span>


	/**
	 * generates a server.ini for Stendhal
	 *
	 * @param args command line parameters
	 * @throws FileNotFoundException in case the file cannot be written
	 */
	public static void main(final String[] args) throws FileNotFoundException {
<span class="nc" id="L157">		gameName = &quot;stendhal&quot;;</span>

		/** Write configuration for database */
<span class="nc" id="L160">		databaseImplementation = getDatabaseImplementation();</span>
<span class="nc" id="L161">		databaseSystem = getDatabaseSystem();</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">		if (databaseSystem.equals(&quot;mysql&quot;)) {</span>
<span class="nc" id="L163">			databaseName = getDatabaseName();</span>
<span class="nc" id="L164">			databaseHost = getDatabaseHost();</span>
<span class="nc" id="L165">			databaseUsername = getDatabaseUsername();</span>
<span class="nc" id="L166">			databasePassword = getDatabasePassword();</span>
<span class="nc" id="L167">			System.out.println(&quot;Using \&quot;&quot; + databaseName + &quot;\&quot; as database name\n&quot;);</span>
<span class="nc" id="L168">			System.out.println(&quot;Using \&quot;&quot; + databaseHost + &quot;\&quot; as database host\n&quot;);</span>
<span class="nc" id="L169">			System.out.println(&quot;Using \&quot;&quot; + databaseUsername + &quot;\&quot; as database user\n&quot;);</span>
<span class="nc" id="L170">			System.out.println(&quot;Using \&quot;&quot; + databasePassword + &quot;\&quot; as database user password\n&quot;);</span>

<span class="nc" id="L172">			System.out.println(&quot;In order to make these options effective please run:&quot;);</span>
<span class="nc" id="L173">			System.out.println(&quot;# mysql&quot;);</span>
<span class="nc" id="L174">			System.out.println(&quot;  create database &quot; + databaseName + &quot;;&quot;);</span>
<span class="nc" id="L175">			System.out.println(&quot;  grant all on &quot; + databaseName + &quot;.* to &quot;</span>
					+ databaseUsername + &quot;@localhost identified by '&quot;
					+ databasePassword + &quot;';&quot;);
<span class="nc" id="L178">			System.out.println(&quot;  exit&quot;);</span>
		} else {
<span class="nc" id="L180">			System.out.println(&quot;Using integrated h2 database.&quot;);</span>
		}

<span class="nc" id="L183">		tcpPort = getTCPPort();</span>

<span class="nc" id="L185">		worldImplementation = getWorldImplementation();</span>
<span class="nc" id="L186">		ruleprocessorImplementation = getRuleProcessorImplementation();</span>

<span class="nc" id="L188">		turnLength = getTurnLength();</span>

<span class="nc" id="L190">		statisticsFilename = getStatisticsFilename();</span>

		/* The size of the RSA Key in bits, usually 512 */
<span class="nc" id="L193">		final String keySize = getRSAKeyBits();</span>
<span class="nc" id="L194">		System.out.println(&quot;Using key of &quot; + keySize + &quot; bits.&quot;);</span>
<span class="nc" id="L195">		System.out.println(&quot;Please wait while the key is generated.&quot;);</span>
<span class="nc" id="L196">		rsakey = RSAKey.generateKey(Integer.valueOf(keySize));</span>
<span class="nc" id="L197">		final PrintWriter out = new PrintWriter(new FileOutputStream(filename));</span>
<span class="nc" id="L198">		write(out);</span>
<span class="nc" id="L199">		out.close();</span>

<span class="nc" id="L201">		System.out.println(filename + &quot; has been generated.&quot;);</span>
<span class="nc" id="L202">	}</span>

	private static String getDatabaseSystem() {
<span class="nc" id="L205">		String temp = &quot;&quot;;</span>
		do {
<span class="nc" id="L207">			System.out.println(&quot;Which database system do you want to use? \&quot;h2\&quot; is an integrated database that &quot;);</span>
<span class="nc" id="L208">			System.out.print(&quot;works out of the box, \&quot;mysql\&quot; requires a MySQL server. If in doubt, say \&quot;h2\&quot; [h2]: &quot;);</span>
<span class="nc" id="L209">			temp = getStringWithDefault(in, &quot;h2&quot;).toLowerCase().trim();</span>
<span class="nc bnc" id="L210" title="All 4 branches missed.">		} while (!temp.equals(&quot;h2&quot;) &amp;&amp; !temp.equals(&quot;mysql&quot;));</span>
<span class="nc" id="L211">		return temp;</span>
	}

	private static String getRSAKeyBits() {
<span class="nc" id="L215">		System.out.print(&quot;Write size for the RSA key of the server. Be aware that a key bigger than 1024 could be very long to create (minimum 512) [512]: &quot;);</span>
<span class="nc" id="L216">		final String keySize = getStringWithDefault(in, &quot;512&quot;);</span>
<span class="nc" id="L217">		return keySize;</span>
	}

	private static String getStatisticsFilename() {
<span class="nc" id="L221">		return &quot;./server_stats.xml&quot;;</span>
	}

	private static String getTurnLength() {
<span class="nc" id="L225">		return &quot;300&quot;;</span>
	}

	private static String getRuleProcessorImplementation() {
<span class="nc" id="L229">		return &quot;games.stendhal.server.core.engine.StendhalRPRuleProcessor&quot;;</span>
	}

	private static String getWorldImplementation() {
<span class="nc" id="L233">		return &quot;games.stendhal.server.core.engine.StendhalRPWorld&quot;;</span>
	}

	private static String getTCPPort() {
<span class="nc" id="L237">		return &quot;32160&quot;;</span>
	}

	private static String getDatabaseImplementation() {
<span class="nc" id="L241">		return &quot;games.stendhal.server.core.engine.StendhalPlayerDatabase&quot;;</span>
	}

	private static void write(final PrintWriter out) {
<span class="nc" id="L245">		out.println(&quot;# Generated .ini file for Test Game at &quot; + new Date());</span>
<span class="nc" id="L246">		out.println(&quot;# Database and factory classes. Don't edit.&quot;);</span>
<span class="nc" id="L247">		out.println(&quot;database_implementation=&quot; + databaseImplementation);</span>
<span class="nc" id="L248">		out.println(&quot;factory_implementation=games.stendhal.server.core.engine.StendhalRPObjectFactory&quot;);</span>
<span class="nc" id="L249">		out.println();</span>
<span class="nc" id="L250">		out.println(&quot;# Database information. Edit to match your configuration.&quot;);</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">		if (databaseSystem.equals(&quot;mysql&quot;)) {</span>
<span class="nc" id="L252">			out.println(&quot;jdbc_url=jdbc:mysql://&quot; + databaseHost + &quot;/&quot; + databaseName + &quot;?useUnicode=yes&amp;characterEncoding=UTF-8&quot;);</span>
<span class="nc" id="L253">			out.println(&quot;jdbc_class=com.mysql.jdbc.Driver&quot;);</span>
<span class="nc" id="L254">			out.println(&quot;jdbc_user=&quot; + databaseUsername);</span>
<span class="nc" id="L255">			out.println(&quot;jdbc_pwd=&quot; + databasePassword);</span>
		} else {
<span class="nc" id="L257">			out.println(&quot;database_adapter=marauroa.server.db.adapter.H2DatabaseAdapter&quot;);</span>
<span class="nc" id="L258">			out.println(&quot;jdbc_url=jdbc:h2:~/stendhal/database/h2db;AUTO_RECONNECT=TRUE;DB_CLOSE_ON_EXIT=FALSE&quot;);</span>
<span class="nc" id="L259">			out.println(&quot;#jdbc_url=jdbc:h2:~/stendhal/database/h2db;AUTO_RECONNECT=TRUE;DB_CLOSE_ON_EXIT=FALSE;AUTO_SERVER=TRUE&quot;);</span>
<span class="nc" id="L260">			out.println(&quot;jdbc_class=org.h2.Driver&quot;);</span>
		}
<span class="nc" id="L262">		out.println();</span>
<span class="nc" id="L263">		out.println(&quot;# TCP port stendhald will use. &quot;);</span>
<span class="nc" id="L264">		out.println(&quot;tcp_port=&quot; + tcpPort);</span>
<span class="nc" id="L265">		out.println();</span>
<span class="nc" id="L266">		out.println(&quot;# World and RP configuration. Don't edit.&quot;);</span>
<span class="nc" id="L267">		out.println(&quot;world=&quot; + worldImplementation);</span>
<span class="nc" id="L268">		out.println(&quot;ruleprocessor=&quot; + ruleprocessorImplementation);</span>
<span class="nc" id="L269">		out.println();</span>
<span class="nc" id="L270">		out.println(&quot;turn_length=&quot; + turnLength);</span>
<span class="nc" id="L271">		out.println();</span>
<span class="nc" id="L272">		out.println(&quot;server_typeGame=&quot; + gameName);</span>
<span class="nc" id="L273">		out.println(&quot;server_name=&quot; + gameName + &quot; Marauroa server&quot;);</span>
<span class="nc" id="L274">		out.println(&quot;server_version=1.19.5&quot;);</span>
<span class="nc" id="L275">		out.println(&quot;server_contact=https://sourceforge.net/tracker/?atid=514826&amp;group_id=66537&amp;func=browse&quot;);</span>
<span class="nc" id="L276">		out.println();</span>
<span class="nc" id="L277">		out.println(&quot;# Extensions configured on the server. Enable at will.&quot;);</span>
<span class="nc" id="L278">		out.println(&quot;#server_extension=xxx&quot;);</span>
<span class="nc" id="L279">		out.println(&quot;#xxx=some.package.Classname&quot;);</span>
<span class="nc" id="L280">		out.println();</span>
<span class="nc" id="L281">		out.println(&quot;statistics_filename=&quot; + statisticsFilename);</span>
<span class="nc" id="L282">		out.println();</span>
<span class="nc" id="L283">		rsakey.print(out);</span>
<span class="nc" id="L284">	}</span>

	protected static String getDatabasePassword() {
<span class="nc" id="L287">		System.out.print(&quot;Write value of the database user password: &quot;);</span>
<span class="nc" id="L288">		final String databasepassword = getStringWithoutDefault(in,</span>
				&quot;Please enter a database password&quot;);
<span class="nc" id="L290">		return databasepassword;</span>
	}

	protected static String getDatabaseUsername() {
<span class="nc" id="L294">		System.out.print(&quot;Write name of the database user: &quot;);</span>
<span class="nc" id="L295">		final String databaseuser = getStringWithoutDefault(in,</span>
				&quot;Please enter a database user&quot;);
<span class="nc" id="L297">		return databaseuser;</span>
	}

	protected static String getDatabaseHost() {
<span class="nc" id="L301">		System.out.print(&quot;Write name of the database host [localhost]: &quot;);</span>
<span class="nc" id="L302">		final String databasehost = getStringWithDefault(in, &quot;localhost&quot;);</span>
<span class="nc" id="L303">		return databasehost;</span>
	}

	protected static String getDatabaseName() {
<span class="nc" id="L307">		System.out.print(&quot;Write name of the database [marauroa]: &quot;);</span>
<span class="nc" id="L308">		final String databasename = getStringWithDefault(in, &quot;marauroa&quot;);</span>
<span class="nc" id="L309">		return databasename;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>