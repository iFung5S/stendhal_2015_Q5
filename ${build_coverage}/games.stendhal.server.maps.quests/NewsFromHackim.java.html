<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>NewsFromHackim.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.maps.quests</a> &gt; <span class="el_source">NewsFromHackim.java</span></div><h1>NewsFromHackim.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2011 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.server.maps.quests;

import games.stendhal.common.parser.Sentence;
import games.stendhal.server.core.engine.SingletonRepository;
import games.stendhal.server.entity.item.Item;
import games.stendhal.server.entity.npc.ChatAction;
import games.stendhal.server.entity.npc.ConversationPhrases;
import games.stendhal.server.entity.npc.ConversationStates;
import games.stendhal.server.entity.npc.EventRaiser;
import games.stendhal.server.entity.npc.SpeakerNPC;
import games.stendhal.server.entity.npc.action.SetQuestAction;
import games.stendhal.server.entity.npc.condition.AndCondition;
import games.stendhal.server.entity.npc.condition.GreetingMatchesNameCondition;
import games.stendhal.server.entity.npc.condition.QuestCompletedCondition;
import games.stendhal.server.entity.npc.condition.QuestInStateCondition;
import games.stendhal.server.entity.npc.condition.QuestNotCompletedCondition;
import games.stendhal.server.entity.player.Player;
import games.stendhal.server.maps.Region;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

/**
 * QUEST: News from Hackim
 * 
 * PARTICIPANTS:
 * &lt;ul&gt;
 * &lt;li&gt; Hackim &lt;/li&gt;
 * &lt;li&gt; Xin Blanca &lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * STEPS:
 * &lt;ul&gt;
 * &lt;li&gt; Hackim asks you to give a message to Xin Blanca. &lt;/li&gt;
 * &lt;li&gt; Xin Blanca thanks you with a pair of leather legs. &lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * REWARD:
 * &lt;ul&gt;
 * &lt;li&gt; 10 XP &lt;/li&gt;
 * &lt;li&gt; some karma (2) &lt;/li&gt;
 * &lt;li&gt; a pair of leather legs &lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * REPETITIONS: - None
 */
<span class="fc" id="L60">public class NewsFromHackim extends AbstractQuest {</span>
	private static final String QUEST_SLOT = &quot;news_hackim&quot;;



	@Override
	public String getSlotName() {
<span class="nc" id="L67">		return QUEST_SLOT;</span>
	}
	
	@Override
	public List&lt;String&gt; getHistory(final Player player) {
<span class="nc" id="L72">		final List&lt;String&gt; res = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">		if (!player.hasQuest(QUEST_SLOT)) {</span>
<span class="nc" id="L74">			return res;</span>
		}
<span class="nc" id="L76">		res.add(&quot;Hackim the blacksmith assistant wants me to bring a secret message to Xin Blanca in Semos tavern.&quot;);</span>
<span class="nc" id="L77">		final String questState = player.getQuest(QUEST_SLOT);</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">		if (questState.equals(&quot;rejected&quot;)) {</span>
<span class="nc" id="L79">			res.add(&quot;That job was just too hot for me and I don't want to do anything illegal.&quot;);</span>
<span class="nc" id="L80">			return res;</span>
		}
<span class="nc" id="L82">		res.add(&quot;It can't be that bad to just collect a message to Xin Blanca. What will happen? I'll do it.&quot;);</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">		if (isCompleted(player)) {</span>
<span class="nc" id="L84">			res.add(&quot;I brought Xin Blanca the message by Hackim. That brought me some nice leather legs.&quot;);</span>
		}
<span class="nc" id="L86">		return res;</span>
	}

	private void step_1() {
<span class="fc" id="L90">		final SpeakerNPC npc = npcs.get(&quot;Hackim Easso&quot;);</span>

<span class="fc" id="L92">		npc.add(ConversationStates.ATTENDING,</span>
			ConversationPhrases.QUEST_MESSAGES, 
			new QuestNotCompletedCondition(QUEST_SLOT),
			ConversationStates.QUEST_OFFERED,
			&quot;Pssst! C'mere... do me a favour and tell #Xin #Blanca that the new supply of weapons is ready, will you?&quot;,
			null);

<span class="fc" id="L99">		npc.add(ConversationStates.ATTENDING,</span>
			ConversationPhrases.QUEST_MESSAGES, 
			new QuestCompletedCondition(QUEST_SLOT),
			ConversationStates.ATTENDING, 
			&quot;Thanks, but I don't have any messages to pass on to #Xin. I can't smuggle so often now... I think Xoderos is beginning to suspect something. Anyway, let me know if there's anything else I can do.&quot;,
			null);

<span class="fc" id="L106">		npc.add(</span>
			ConversationStates.QUEST_OFFERED,
			ConversationPhrases.YES_MESSAGES,
			null,
			ConversationStates.ATTENDING,
			&quot;Thanks! I'm sure that #Xin will reward you generously. Let me know if you need anything else.&quot;,
			new SetQuestAction(QUEST_SLOT, &quot;start&quot;));

<span class="fc" id="L114">		npc.add(</span>
			ConversationStates.QUEST_OFFERED,
			ConversationPhrases.NO_MESSAGES,
			null,
			ConversationStates.ATTENDING,
			&quot;Yes, now that I think about it, it probably isn't wise to involve too many people in this... Just forget we spoke, okay? You never heard anything, if you know what I mean.&quot;,
			new SetQuestAction(QUEST_SLOT, &quot;rejected&quot;));

<span class="fc" id="L122">		npc.add(</span>
			ConversationStates.QUEST_OFFERED,
			Arrays.asList(&quot;Xin&quot;, &quot;Xin Blanca&quot;, &quot;Blanca&quot;),
			null,
			ConversationStates.QUEST_OFFERED,
			&quot;You don't know who Xin is? Everybody at the tavern knows Xin. He's the guy who owes beer money to most of the people in Semos! So, will you do it?&quot;,
			null);
		
<span class="fc" id="L130">		npc.addReply(Arrays.asList(&quot;Xin&quot;, &quot;Xin Blanca&quot;, &quot;Blanca&quot;), &quot;Xin's so cool. I want to work in the tavern too like him but my dad says I have to learn a trade.&quot;);</span>
<span class="fc" id="L131">	}</span>

	private void step_2() {
<span class="fc" id="L134">		final SpeakerNPC npc = npcs.get(&quot;Xin Blanca&quot;);</span>

<span class="fc" id="L136">		npc.add(ConversationStates.IDLE, ConversationPhrases.GREETING_MESSAGES,</span>
			new AndCondition(new GreetingMatchesNameCondition(npc.getName()),
					new QuestInStateCondition(QUEST_SLOT, &quot;start&quot;)),
			ConversationStates.ATTENDING, null,
<span class="fc" id="L140">			new ChatAction() {</span>
				@Override
				public void fire(final Player player, final Sentence sentence, final EventRaiser raiser) {
					String answer;
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">					if (player.isEquipped(&quot;leather legs&quot;)) {</span>
<span class="nc" id="L145">						answer = &quot;Take this set of brand new... oh, you already have leather leg armor. Well, maybe you can sell them off or something.&quot;;</span>
					} else {
<span class="fc" id="L147">						answer = &quot;Take this set of brand new leather leg armor! Let me know if you want anything else.&quot;;</span>
					}
					// player.say(&quot;Well, to make a long story short; I know
					// your business with Hackim and I'm here to tell you
					// that the next shipment is ready.&quot;);
<span class="fc" id="L152">					raiser.say(&quot;Ah, it's ready at last! That is very good news indeed! Here, let me give you a little something for your help... &quot;</span>
									+ answer);
<span class="fc" id="L154">					player.setQuest(QUEST_SLOT, &quot;done&quot;);</span>

<span class="fc" id="L156">					final Item item = SingletonRepository.getEntityManager().getItem(&quot;leather legs&quot;);</span>
<span class="fc" id="L157">					player.equipOrPutOnGround(item);</span>
<span class="fc" id="L158">					player.addXP(10);</span>
<span class="fc" id="L159">					player.addKarma(2);</span>

<span class="fc" id="L161">					player.notifyWorldAboutChanges();</span>
<span class="fc" id="L162">				}</span>
			});
<span class="fc" id="L164">	}</span>

	@Override
	public void addToWorld() {
<span class="fc" id="L168">		fillQuestInfo(</span>
				&quot;News from Hackim&quot;,
				&quot;Hackim Easso, the Semos blacksmith assistant, needs help to send a message to someone.&quot;,
				false);
<span class="fc" id="L172">		step_1();</span>
<span class="fc" id="L173">		step_2();</span>
<span class="fc" id="L174">	}</span>

	@Override
	public String getName() {
<span class="nc" id="L178">		return &quot;NewsFromHackim&quot;;</span>
	}
	
	@Override
	public String getRegion() {
<span class="nc" id="L183">		return Region.SEMOS_CITY;</span>
	}

	@Override
	public String getNPCName() {
<span class="nc" id="L188">		return &quot;Hackim Easso&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>