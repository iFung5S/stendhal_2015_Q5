<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MixtureForOrtiv.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.maps.quests</a> &gt; <span class="el_source">MixtureForOrtiv.java</span></div><h1>MixtureForOrtiv.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2010 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.server.maps.quests;

import games.stendhal.common.grammar.Grammar;
import games.stendhal.server.entity.npc.ChatAction;
import games.stendhal.server.entity.npc.ConversationPhrases;
import games.stendhal.server.entity.npc.ConversationStates;
import games.stendhal.server.entity.npc.SpeakerNPC;
import games.stendhal.server.entity.npc.action.CollectRequestedItemsAction;
import games.stendhal.server.entity.npc.action.EquipItemAction;
import games.stendhal.server.entity.npc.action.IncreaseKarmaAction;
import games.stendhal.server.entity.npc.action.IncreaseXPAction;
import games.stendhal.server.entity.npc.action.MultipleActions;
import games.stendhal.server.entity.npc.action.SayRequiredItemsFromCollectionAction;
import games.stendhal.server.entity.npc.action.SayTextAction;
import games.stendhal.server.entity.npc.action.SetQuestAction;
import games.stendhal.server.entity.npc.action.SetQuestAndModifyKarmaAction;
import games.stendhal.server.entity.npc.condition.AndCondition;
import games.stendhal.server.entity.npc.condition.GreetingMatchesNameCondition;
import games.stendhal.server.entity.npc.condition.LevelGreaterThanCondition;
import games.stendhal.server.entity.npc.condition.NotCondition;
import games.stendhal.server.entity.npc.condition.QuestActiveCondition;
import games.stendhal.server.entity.npc.condition.QuestCompletedCondition;
import games.stendhal.server.entity.npc.condition.QuestInStateCondition;
import games.stendhal.server.entity.npc.condition.QuestNotStartedCondition;
import games.stendhal.server.entity.player.Player;
import games.stendhal.server.maps.Region;
import games.stendhal.server.util.ItemCollection;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;

/**
 * QUEST: Mixture for Ortiv
 * 
 * PARTICIPANTS:
 * &lt;ul&gt;
 * &lt;li&gt;Ortiv Milquetoast, the retired teacher who lives in the Kirdneh River house&lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * STEPS:
 * &lt;ul&gt;
 * &lt;li&gt;Ortiv asks you for some ingredients for a mixture which will help him to keep the assassins and bandits in the cellar&lt;/li&gt;
 * &lt;li&gt;Find the ingredients&lt;/li&gt;
 * &lt;li&gt;Take the ingredients back to Ortiv&lt;/li&gt;
 * &lt;li&gt;Ortiv gives you a reward&lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * REWARD:
 * &lt;ul&gt;
 * &lt;li&gt;karma +35&lt;/li&gt;
 * &lt;li&gt;5000 XP&lt;/li&gt;
 * &lt;li&gt;a bounded assassin dagger&lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * REPETITIONS:
 * &lt;ul&gt;
 * &lt;li&gt;None&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * @author Vanessa Julius
 */
<span class="nc" id="L76">public class MixtureForOrtiv extends AbstractQuest {</span>

	public static final String QUEST_SLOT = &quot;mixture_for_ortiv&quot;;

	/**
	 * required items for the quest.
	 */
	protected static final String NEEDED_ITEMS = &quot;flask=1;arandula=2;red lionfish=10;kokuda=1;toadstool=12;licorice=2;apple=10;wine=30;garlic=2;pestle and mortar=1&quot;;

	@Override
	public List&lt;String&gt; getHistory(final Player player) {
<span class="nc" id="L87">		final List&lt;String&gt; res = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">		if (!player.hasQuest(QUEST_SLOT)) {</span>
<span class="nc" id="L89">			return res;</span>
		}
<span class="nc" id="L91">		res.add(&quot;I met Ortiv Milquetoast, a retired teacher in his house at Kirdneh River and asked him for a quest.&quot;);</span>
<span class="nc" id="L92">		final String questState = player.getQuest(QUEST_SLOT);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">		if (&quot;rejected&quot;.equals(questState)) {</span>
<span class="nc" id="L94">			res.add(&quot;I don't want to help Ortiv at the moment. He should go out and take the ingredients by himself.&quot;);</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">		} else if (!&quot;done&quot;.equals(questState)) {</span>
<span class="nc" id="L96">			final ItemCollection missingItems = new ItemCollection();</span>
<span class="nc" id="L97">			missingItems.addFromQuestStateString(questState);</span>
<span class="nc" id="L98">			res.add(&quot;I still need to bring Ortiv &quot; + Grammar.enumerateCollection(missingItems.toStringList()) + &quot;.&quot;);</span>
<span class="nc" id="L99">		} else {</span>
<span class="nc" id="L100">			res.add(&quot;I helped Ortiv. Now he can sleep safe again in his bed. He rewarded me with some XP and an assassin dagger for my use.&quot;);</span>
		}
<span class="nc" id="L102">		return res;</span>
	}

	private void prepareRequestingStep() {
<span class="nc" id="L106">		final SpeakerNPC npc = npcs.get(&quot;Ortiv Milquetoast&quot;);</span>

<span class="nc" id="L108">		npc.add(ConversationStates.IDLE, ConversationPhrases.GREETING_MESSAGES,</span>
			new AndCondition(new GreetingMatchesNameCondition(npc.getName()),
					new LevelGreaterThanCondition(2),
					new QuestNotStartedCondition(QUEST_SLOT),
					new NotCondition(new QuestInStateCondition(QUEST_SLOT,&quot;rejected&quot;))),
			ConversationStates.QUESTION_1, 
			&quot;Ohh a stranger found my hidden house, welcome! Maybe you can help me with something?&quot;, null);

<span class="nc" id="L116">		npc.add(ConversationStates.IDLE, ConversationPhrases.GREETING_MESSAGES,</span>
			new AndCondition(new GreetingMatchesNameCondition(npc.getName()),
						new QuestInStateCondition(QUEST_SLOT,&quot;rejected&quot;)),
			ConversationStates.QUEST_OFFERED, 
			&quot;Hey, did you think about helping me again? Will you do it?&quot;, null);

<span class="nc" id="L122">		npc.add(</span>
			ConversationStates.QUESTION_1,
			ConversationPhrases.YES_MESSAGES,
			new QuestNotStartedCondition(QUEST_SLOT),
			ConversationStates.ATTENDING,
			&quot;I currently work on a mixture to keep the rowdy gang downstairs... Maybe you can help me later with getting me some of the #ingredients I'll need.&quot;,
			null);

<span class="nc" id="L130">		npc.add(</span>
			ConversationStates.QUESTION_1,
			ConversationPhrases.NO_MESSAGES,
			new QuestNotStartedCondition(QUEST_SLOT),
			ConversationStates.ATTENDING,
			&quot;I currently work on a mixture to keep the rowdy gang downstairs... Maybe you can help me later with getting me some of the #ingredients I'll need.&quot;,
			null);

<span class="nc" id="L138">		npc.add(</span>
			ConversationStates.ATTENDING,
			&quot;ingredients&quot;,
			new QuestNotStartedCondition(QUEST_SLOT),
			ConversationStates.QUEST_OFFERED,
			&quot;I was a teacher for alchemy once, now I try to mix something together. I need some ingredients for that and hope that you will help me. Will you?&quot;,
			null);

<span class="nc" id="L146">		npc.add(</span>
			ConversationStates.QUEST_OFFERED,
			ConversationPhrases.YES_MESSAGES,
			null,
			ConversationStates.ATTENDING,
			null,
			new MultipleActions(new SetQuestAction(QUEST_SLOT, NEEDED_ITEMS),
							    new SayRequiredItemsFromCollectionAction(QUEST_SLOT, &quot;Oh that would be wonderful, stranger! You might save my life! Please bring me [items].&quot;)));

<span class="nc" id="L155">		npc.add(</span>
			ConversationStates.QUEST_OFFERED,
			ConversationPhrases.NO_MESSAGES,
			null,
			ConversationStates.ATTENDING,
			&quot;I thought you would maybe help me... But I was wrong, obviously... So wrong as with my students while I was a teacher...&quot;,
			new SetQuestAndModifyKarmaAction(QUEST_SLOT, &quot;rejected&quot;, -5.0));

<span class="nc" id="L163">		npc.addReply(&quot;apple&quot;, &quot;Apples are the favourite food of assassins. I saw some apple trees on the east &quot; +</span>
				&quot;of semos and near to Orril and Nalwor river.&quot;);

<span class="nc" id="L166">			npc.addReply(&quot;flask&quot;, &quot;I've heard of a young woman in Semos who sells them.&quot;);</span>

<span class="nc" id="L168">			npc.addReply(&quot;toadstool&quot;, &quot;Toadstools are quite poisonous. I've heard that some hunters in the forests ate a few&quot; +</span>
					&quot; and felt sick for days.&quot;);

<span class="nc" id="L171">			npc.addReply(&quot;arandula&quot;, &quot;North of Semos, near the tree grove, grows a herb called arandula as some of my old friends told me.&quot;);</span>
			
<span class="nc" id="L173">			npc.addReply(&quot;red lionfish&quot;,&quot;Red lionfish are hard to find...They are clad in white stripes alternated with red, maroon, &quot; +</span>
					&quot;or brown. I've heard about a place in Faiumoni where you can fish for some but be careful, every spine of the lionfish is venomous!&quot;);
			
<span class="nc" id="L176">			npc.addReply(&quot;kokuda&quot;,&quot;Kokuda is really hard to find. I'm glad if you can try to get one from Athor island...&quot;);</span>

<span class="nc" id="L178">			npc.addReply(&quot;licorice&quot;, &quot;There is a nice little bar in magic city in which a young girl sells this lovely tasting sweet.&quot;);</span>
			
<span class="nc" id="L180">			npc.addReply(&quot;wine&quot;, &quot;Mhhhmm there isn't anything better than mixing stuff together while enjoying a glass of red wine *cough* but I need it of course for my mixture as well... I bet, you can buy wine somewhere, maybe in a tavern or a bar...&quot;);</span>
			
<span class="nc" id="L182">			npc.addReply(&quot;garlic&quot;, &quot;I know, assassins and bandits aren't vampires, but I'll try to use it against them as well. There is a nice gardener in the Kalavan City Gardens who may sell some of her own grown garlic.&quot;);</span>
			
<span class="nc" id="L184">			npc.addReply(Arrays.asList(&quot;pestle&quot;,&quot;mortar&quot;,&quot;pestle and mortar&quot;), &quot;Perhaps some baker or cook would use one of those.&quot;);</span>
<span class="nc" id="L185">	}</span>

	private void prepareBringingStep() {
<span class="nc" id="L188">		final SpeakerNPC npc = npcs.get(&quot;Ortiv Milquetoast&quot;);</span>
	
<span class="nc" id="L190">		npc.add(ConversationStates.IDLE, ConversationPhrases.GREETING_MESSAGES,</span>
				new AndCondition(new GreetingMatchesNameCondition(npc.getName()),
						new QuestActiveCondition(QUEST_SLOT)),
				ConversationStates.QUESTION_2,
				&quot;Hello again! I'm glad to see you. Did you bring me any #ingredients for my mixture?&quot;,
				null);
		
		/* player asks what exactly is missing (says ingredients) */
<span class="nc" id="L198">		npc.add(ConversationStates.QUESTION_2, &quot;ingredients&quot;, null,</span>
				ConversationStates.QUESTION_2, null,
				new SayRequiredItemsFromCollectionAction(QUEST_SLOT, &quot;I need [items]. Did you bring something?&quot;));

		/* player says he has a required item with him (says yes) */
<span class="nc" id="L203">		npc.add(ConversationStates.QUESTION_2,</span>
				ConversationPhrases.YES_MESSAGES, null,
				ConversationStates.QUESTION_2, &quot;Awesome, what did you bring?&quot;,
				null);

<span class="nc" id="L208">		ChatAction completeAction = new  MultipleActions(</span>
				new SetQuestAction(QUEST_SLOT, &quot;done&quot;),
				new SayTextAction(&quot;Thank you so much! Now I can start mixing the mixture which will hopefully keep me safe inside of my own house without the assassins and bandits comming up from downstairs. Here is an assassin dagger for you. I had to take it away from one of my students in the class once and now you can maybe fight and win against them.&quot;),
				new IncreaseXPAction(5000),
				new IncreaseKarmaAction(25),
				new EquipItemAction(&quot;assassin dagger&quot;, 1 ,true)
				);
		/* add triggers for the item names */
<span class="nc" id="L216">		final ItemCollection items = new ItemCollection();</span>
<span class="nc" id="L217">		items.addFromQuestStateString(NEEDED_ITEMS);</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">		for (final Map.Entry&lt;String, Integer&gt; item : items.entrySet()) {</span>
<span class="nc" id="L219">			npc.add(ConversationStates.QUESTION_2, item.getKey(), null,</span>
					ConversationStates.QUESTION_2, null,
					new CollectRequestedItemsAction(
							item.getKey(), QUEST_SLOT,
							&quot;Wonderful! Did you bring anything else with you?&quot;, &quot;You brought me that ingredient already.&quot;,
							completeAction, ConversationStates.ATTENDING));
<span class="nc" id="L225">		}</span>

		/* player says he didn't bring any items (says no) */
<span class="nc" id="L228">		npc.add(ConversationStates.ATTENDING, ConversationPhrases.NO_MESSAGES,</span>
				new QuestActiveCondition(QUEST_SLOT),
				ConversationStates.ATTENDING,
				&quot;Ok, well I have to be a bit more patient then. Just let me know if I can #help you somehow instead.&quot;, 
				null);

		/* player says he didn't bring any items to different question */
<span class="nc" id="L235">		npc.add(ConversationStates.QUESTION_2,</span>
				ConversationPhrases.NO_MESSAGES,
				new QuestActiveCondition(QUEST_SLOT),
				ConversationStates.ATTENDING,
				&quot;Ok, well I have to be a bit more patient then. Just let me know if I can #help you somehow instead.&quot;, null);

<span class="nc" id="L241">		npc.add(ConversationStates.IDLE, </span>
				ConversationPhrases.GREETING_MESSAGES,
				new AndCondition(new GreetingMatchesNameCondition(npc.getName()),
						new QuestCompletedCondition(QUEST_SLOT)),
				ConversationStates.ATTENDING, 
				&quot;Thank you so much! I can sleep safely and calm again now! You rescued me!&quot;, null);
<span class="nc" id="L247">	}</span>
	

	@Override
	public void addToWorld() {
<span class="nc" id="L252">		fillQuestInfo(</span>
				&quot;Mixture for Ortiv&quot;,
				&quot;Ortiv needs some ingredients for a mixture which will help him to keep the assassins and bandits in the cellar.&quot;,
				true);
<span class="nc" id="L256">		prepareRequestingStep();</span>
<span class="nc" id="L257">		prepareBringingStep();</span>
<span class="nc" id="L258">	}</span>

	@Override
	public String getSlotName() {
<span class="nc" id="L262">		return QUEST_SLOT;</span>
	}

	@Override
	public String getName() {
<span class="nc" id="L267">		return &quot;MixtureForOrtiv&quot;;</span>
	}

	public String getTitle() {
		
<span class="nc" id="L272">		return &quot;Mixture for Ortiv&quot;;</span>
	}

	@Override
	public String getNPCName() {
<span class="nc" id="L277">		return &quot;Ortiv Milquetoast&quot;;</span>
	}
	
	@Override
	public String getRegion() {
<span class="nc" id="L282">		return Region.KIRDNEH;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>