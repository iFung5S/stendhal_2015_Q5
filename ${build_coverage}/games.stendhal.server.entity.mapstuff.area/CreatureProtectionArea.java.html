<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CreatureProtectionArea.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.entity.mapstuff.area</a> &gt; <span class="el_source">CreatureProtectionArea.java</span></div><h1>CreatureProtectionArea.java</h1><pre class="source lang-java linenums">/*
 * @(#) src/games/stendhal/server/entity/area/CreatureProtectionArea.java
 *
 * $Id$
 */

package games.stendhal.server.entity.mapstuff.area;

import games.stendhal.server.entity.Entity;
import games.stendhal.server.entity.creature.Creature;

import java.util.LinkedList;
import java.util.List;

/**
 * An area prevents creatures from entering. This allows a layered chain of
 * criteria. Think of this as a creature firewall.
 */
public class CreatureProtectionArea extends AreaEntity {

	/**
	 * Whether to block on no match.
	 */
	protected boolean defaultBlocked;

	/**
	 * The list (if any specific) of blocked creatures.
	 */
	protected List&lt;Entry&gt; entries;

	/**
	 * Create a 1x1 creature protection area.
	 */
	public CreatureProtectionArea() {
<span class="nc" id="L35">		this(1, 1);</span>
<span class="nc" id="L36">	}</span>

	/**
	 * Create a creature protection area.
	 * 
	 * @param width
	 *            The area width.
	 * @param height
	 *            The area height.
	 */
	public CreatureProtectionArea(final int width, final int height) {
<span class="nc" id="L47">		this(width, height, true);</span>
<span class="nc" id="L48">	}</span>

	/**
	 * Create a creature protection area.
	 * 
	 * @param width
	 *            The area width.
	 * @param height
	 *            The area height.
	 * @param defaultBlocked
	 *            Whether blocked on no match.
	 */
	public CreatureProtectionArea(final int width, final int height, final boolean defaultBlocked) {
<span class="nc" id="L61">		super(width, height);</span>

<span class="nc" id="L63">		hide();</span>
<span class="nc" id="L64">		setResistance(0);</span>

<span class="nc" id="L66">		this.defaultBlocked = defaultBlocked;</span>

<span class="nc" id="L68">		entries = new LinkedList&lt;Entry&gt;();</span>
<span class="nc" id="L69">	}</span>

	//
	// CreatureProtectionArea
	//

	/**
	 * Add a blocked criteria entry.
	 * 
	 * @param clazz
	 *            A creature class to match (or &lt;code&gt;null&lt;/code&gt; for any).
	 */
	public void add(final String clazz) {
<span class="nc" id="L82">		add(clazz, null);</span>
<span class="nc" id="L83">	}</span>

	/**
	 * Add a blocked criteria entry.
	 * 
	 * @param clazz
	 *            A creature class to match (or &lt;code&gt;null&lt;/code&gt; for any).
	 * @param subclazz
	 *            A creature subclass to match (or &lt;code&gt;null&lt;/code&gt; for any).
	 */
	public void add(final String clazz, final String subclazz) {
<span class="nc" id="L94">		add(clazz, subclazz, true);</span>
<span class="nc" id="L95">	}</span>

	/**
	 * Add a criteria entry.
	 * 
	 * @param clazz
	 *            A creature class to match (or &lt;code&gt;null&lt;/code&gt; for any).
	 * @param subclazz
	 *            A creature subclass to match (or &lt;code&gt;null&lt;/code&gt; for any).
	 * @param blocked
	 *            Whether to block.
	 */
	public void add(final String clazz, final String subclazz, final boolean blocked) {
<span class="nc" id="L108">		entries.add(new Entry(clazz, subclazz, blocked));</span>
<span class="nc" id="L109">	}</span>

	/**
	 * Does a creature match a criteria entry.
	 * 
	 * @param creature
	 *            The creature to compare.
	 * @param defaultAnswer
	 *            The answer if no match is found.
	 * 
	 * @return The matching criteria, or default response.
	 */
	protected boolean matchesCriteria(final Creature creature, final boolean defaultAnswer) {
		String clazz;
		String subclazz;

		/*
		 * Allow for optional class data. Technically all creatures should at
		 * least have an entity class type.
		 */
<span class="nc bnc" id="L129" title="All 2 branches missed.">		if (creature.has(&quot;class&quot;)) {</span>
<span class="nc" id="L130">			clazz = creature.get(&quot;class&quot;);</span>
		} else {
<span class="nc" id="L132">			clazz = &quot;&quot;;</span>
		}

<span class="nc bnc" id="L135" title="All 2 branches missed.">		if (creature.has(&quot;subclass&quot;)) {</span>
<span class="nc" id="L136">			subclazz = creature.get(&quot;subclass&quot;);</span>
		} else {
<span class="nc" id="L138">			subclazz = &quot;&quot;;</span>
		}

<span class="nc bnc" id="L141" title="All 2 branches missed.">		for (final Entry entry : entries) {</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">			if (entry.matches(clazz, subclazz)) {</span>
<span class="nc" id="L143">				return entry.isBlocked();</span>
			}
<span class="nc" id="L145">		}</span>

<span class="nc" id="L147">		return defaultAnswer;</span>
	}

	//
	// Entity
	//

	/**
	 * Checks whether a creature can enter.
	 * 
	 * @return &lt;code&gt;true&lt;/code&gt; if a matching creature is given.
	 */
	@Override
	public boolean isObstacle(final Entity entity) {
		/*
		 * Only applies to Creature's
		 */
<span class="nc bnc" id="L164" title="All 2 branches missed.">		if (!(entity instanceof Creature)) {</span>
<span class="nc" id="L165">			return super.isObstacle(entity);</span>
		}

<span class="nc" id="L168">		return matchesCriteria((Creature) entity, defaultBlocked);</span>
	}

	//
	//

	/**
	 * An entry representing creature criteria.
	 */
	protected static class Entry {

		/**
		 * Whether it should be blocked.
		 */
		protected boolean blocked;

		/**
		 * The creature class to match.
		 */
		protected String clazz;

		/**
		 * The creature subclass to match.
		 */
		protected String subclazz;

		/**
		 * Create a criteria entry.
		 * 
		 * @param clazz
		 *            A creature class to match (or &lt;code&gt;null&lt;/code&gt; for
		 *            any).
		 * @param subclazz
		 *            A creature subclass to match (or &lt;code&gt;null&lt;/code&gt; for
		 *            any).
		 * @param blocked
		 *            Whether it should be blocked.
		 */
<span class="nc" id="L206">		public Entry(final String clazz, final String subclazz, final boolean blocked) {</span>
<span class="nc" id="L207">			this.clazz = clazz;</span>
<span class="nc" id="L208">			this.subclazz = subclazz;</span>
<span class="nc" id="L209">			this.blocked = blocked;</span>
<span class="nc" id="L210">		}</span>

		//
		// Entry
		//

		/**
		 * Determine if a creature matching this criteria is blocked.
		 * 
		 * @return &lt;code&gt;true&lt;/code&gt; if it should be blocked.
		 */
		public boolean isBlocked() {
<span class="nc" id="L222">			return blocked;</span>
		}

		/**
		 * Check if a class/subclass matches.
		 * @param clazz 
		 * @param subclazz 
		 * @return true if both are equals to fields
		 * 
		 * 
		 * 
		 */
		public boolean matches(final String clazz, final String subclazz) {
<span class="nc bnc" id="L235" title="All 4 branches missed.">			if ((this.clazz != null) &amp;&amp; !clazz.equals(this.clazz)) {</span>
<span class="nc" id="L236">				return false;</span>
			}

<span class="nc bnc" id="L239" title="All 4 branches missed.">			if ((this.subclazz != null) &amp;&amp; !subclazz.equals(this.subclazz)) {</span>
<span class="nc" id="L240">				return false;</span>
			}

<span class="nc" id="L243">			return true;</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>