<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Bootstrap.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.client.update</a> &gt; <span class="el_source">Bootstrap.java</span></div><h1>Bootstrap.java</h1><pre class="source lang-java linenums">/***************************************************************************
 *                   (C) Copyright 2003-2011 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.client.update;

import static java.io.File.separator;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.lang.reflect.Method;
import java.net.URL;
import java.net.URLClassLoader;
import java.security.AccessController;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.security.PrivilegedAction;
import java.security.cert.Certificate;
import java.security.cert.X509Certificate;
import java.util.LinkedList;
import java.util.List;
import java.util.Properties;
import java.util.StringTokenizer;

import javax.swing.JOptionPane;

/**
 * Starts a program after doing some classpath magic.
 *
 * @author hendrik
 */
<span class="nc" id="L43">public class Bootstrap {</span>
	private String jarFolder;
	private Properties bootProp;
	private Properties bootPropOrg;


	/**
	 * saves modified boot properties to disk.
	 *
	 * @throws IOException
	 *             if an IO-error occurs
	 */
	public void saveBootProp() throws IOException {
		// only try to save it, if it was changed (so that we do not have to
		// care about all the things which could go wrong unless an update
		// was done this time.)
<span class="nc bnc" id="L59" title="All 2 branches missed.">		if (!bootProp.equals(bootPropOrg)) {</span>
<span class="nc" id="L60">			final String propFile = jarFolder + &quot;jar.properties&quot;;</span>
<span class="nc" id="L61">			final OutputStream os = new FileOutputStream(propFile);</span>
			try {
<span class="nc" id="L63">				bootProp.store(os, &quot;Stendhal Boot Configuration&quot;);</span>
			} finally {
<span class="nc" id="L65">				os.close();</span>
<span class="nc" id="L66">			}</span>
		}
<span class="nc" id="L68">	}</span>

	/**
	 * initializes the startup process.
	 */
	void init() {
		// discover folder for .jar-files
		// Copied from stendhal.java; don't change this to anything different
		// from than what's there
<span class="nc" id="L77">		final String stendhal = ClientGameConfiguration.get(&quot;GAME_NAME&quot;).toLowerCase();</span>
<span class="nc" id="L78">		System.out.println(&quot;GAME: &quot; + stendhal);</span>
<span class="nc" id="L79">		String topFolder = System.getProperty(&quot;user.home&quot;) + separator + stendhal + separator;</span>
<span class="nc" id="L80">		String unixLikes = &quot;AIX|Digital Unix|FreeBSD|HP UX|Irix|Linux|Mac OS X|Solaris&quot;;</span>
<span class="nc" id="L81">		String system = System.getProperty(&quot;os.name&quot;);</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">		if (system.matches(unixLikes)) {</span>
			// Check first if the user has important data in the default folder.
<span class="nc" id="L84">			File f = new File(topFolder + &quot;user.dat&quot;);</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">			if (!f.exists()) {</span>
<span class="nc" id="L86">				topFolder = System.getProperty(&quot;user.home&quot;) + separator</span>
				+ &quot;.config&quot; + separator + stendhal + separator;
			}
		}

<span class="nc" id="L91">		jarFolder = topFolder + &quot;jar&quot; + separator;</span>
<span class="nc" id="L92">		final File folder = new File(jarFolder);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">		if (!folder.exists()) {</span>
<span class="nc" id="L94">			folder.mkdirs();</span>
		}
<span class="nc" id="L96">		System.setProperty(&quot;log4j.ignoreTCL&quot;, &quot;true&quot;);</span>
<span class="nc" id="L97">	}</span>

	/**
	 * Sets a dynamic classpath up and returns a Class reference loaded from it.
	 *
	 * @param includeUpdates should updates from jar.properties be included
	 * @param firstPhase true, if this is the first phase before the updater is executed
	 * @return ClassLoader object
	 * @throws Exception
	 *             if an unexpected error occurs
	 */
	ClassLoader createClassloader(boolean includeUpdates, boolean firstPhase) throws Exception {
<span class="nc" id="L109">		final List&lt;URL&gt; jarFiles = new LinkedList&lt;URL&gt;();</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">		if (includeUpdates) {</span>
			// load jar.properties
<span class="nc" id="L112">			final String propFile = jarFolder + &quot;jar.properties&quot;;</span>
<span class="nc" id="L113">			bootProp = new Properties();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">			if (new File(propFile).canRead()) {</span>
<span class="nc" id="L115">				final InputStream is = new FileInputStream(propFile);</span>
				try {
<span class="nc" id="L117">					bootProp.load(is);</span>
				} finally {
<span class="nc" id="L119">					is.close();</span>
<span class="nc" id="L120">				}</span>
<span class="nc" id="L121">				bootPropOrg = (Properties) bootProp.clone();</span>

				// get list of .jar-files
<span class="nc" id="L124">				final String jarNameString = bootProp.getProperty(&quot;load-0.95&quot;, &quot;&quot;);</span>
<span class="nc" id="L125">				final StringTokenizer st = new StringTokenizer(jarNameString, &quot;,&quot;);</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">				while (st.hasMoreTokens()) {</span>
<span class="nc" id="L127">					final String filename = st.nextToken();</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">					if (SignatureVerifier.get().checkSignature(jarFolder + filename, bootProp.getProperty(&quot;file-signature.&quot; + filename))) {</span>
<span class="nc" id="L129">						jarFiles.add(new File(jarFolder + filename).toURI().toURL());</span>
					} else {
<span class="nc bnc" id="L131" title="All 2 branches missed.">						if (firstPhase) {</span>
							// if the signature of one file is not valid, ignore all files and do a fresh download
<span class="nc" id="L133">							clearUpdateFiles();</span>
<span class="nc" id="L134">							ClassLoader loader = new URLClassLoader(new URL[0], this.getClass().getClassLoader());</span>
<span class="nc" id="L135">							return loader;</span>
						}
					}
<span class="nc" id="L138">				}</span>
<span class="nc" id="L139">				System.out.println(&quot;our classpath: &quot; + jarNameString);</span>
<span class="nc" id="L140">			} else {</span>
<span class="nc" id="L141">				System.out.println(&quot;no jar.properties&quot;);</span>
			}
		}

		// add the files in the download distribution at the end of the classpath
<span class="nc" id="L146">		ClassLoader orgClassloader = Bootstrap.class.getClassLoader();</span>
<span class="nc" id="L147">		String[] includedJarFiles = new String[] { &quot;lib/log4j.jar&quot;, &quot;lib/marauroa.jar&quot;, &quot;lib/jorbis.jar&quot;,</span>
				&quot;lib/stendhal.jar&quot;, &quot;lib/stendhal-data.jar&quot;, &quot;lib/stendhal-sound-data.jar&quot;,
				&quot;lib/stendhal-music-data.jar&quot;};
<span class="nc bnc" id="L150" title="All 2 branches missed.">		for (String includedJarFile : includedJarFiles) {</span>
<span class="nc" id="L151">			URL url = orgClassloader.getResource(includedJarFile);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">			if (url != null) {</span>
<span class="nc" id="L153">				jarFiles.add(url);</span>
			}
		}
<span class="nc" id="L156">		System.out.println(&quot;Creating custom class loader for: &quot; + jarFiles);</span>

		// Create new class loader with the list of .jar-files as classpath
<span class="nc" id="L159">		final URL[] urlArray = jarFiles.toArray(new URL[jarFiles.size()]);</span>
<span class="nc" id="L160">		final ClassLoader loader = new URLClassLoader(urlArray,</span>
				this.getClass().getClassLoader());
<span class="nc" id="L162">		return loader;</span>
	}

	/**
	 * Do the whole start up process in a privileged block.
	 * @param &lt;T&gt;
	 */
<span class="nc" id="L169">	private class PrivilegedBoot&lt;T&gt; implements PrivilegedAction&lt;T&gt; {</span>

		private final String className;

		private final String[] args;

		/**
		 * Creates a PrivilagedBoot object.
		 *
		 * @param className
		 *            className to boot
		 * @param args
		 *            arguments for the main-method
		 */
<span class="nc" id="L183">		public PrivilegedBoot(final String className, final String[] args) {</span>
<span class="nc" id="L184">			this.className = className;</span>
<span class="nc" id="L185">			this.args = args;</span>
<span class="nc" id="L186">		}</span>

		/**
		 * Handles the update procedure.
		 */
		private void handleUpdate() {
			// invoke update handling first
			try {
<span class="nc" id="L194">				final ClassLoader classLoader = createClassloader(true, true);</span>
				// is this the initial download (or do we already have the
				// program downloaded)?
<span class="nc" id="L197">				boolean initialDownload = false;</span>
				try {
<span class="nc" id="L199">					classLoader.loadClass(className);</span>
<span class="nc" id="L200">					classLoader.loadClass(&quot;org.apache.log4j.Logger&quot;);</span>
<span class="nc" id="L201">					classLoader.loadClass(&quot;marauroa.common.Logger&quot;);</span>
<span class="nc" id="L202">					classLoader.loadClass(&quot;marauroa.client.ClientFramework&quot;);</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">					if (classLoader.getResource(ClientGameConfiguration.get(&quot;GAME_ICON&quot;)) == null) {</span>
<span class="nc" id="L204">						throw new ClassNotFoundException(ClientGameConfiguration.get(&quot;GAME_ICON&quot;));</span>
					}
<span class="nc bnc" id="L206" title="All 2 branches missed.">					if (classLoader.getResource(&quot;data/gui/offline.png&quot;) == null) {</span>
<span class="nc" id="L207">						throw new ClassNotFoundException(ClientGameConfiguration.get(&quot;data/gui/offline.png&quot;));</span>
					}
<span class="nc" id="L209">				} catch (final ClassNotFoundException e) {</span>
<span class="nc" id="L210">					initialDownload = true;</span>
<span class="nc" id="L211">					System.out.println(&quot;Initial Download triggered by the following missing classes: &quot; + e);</span>
<span class="nc" id="L212">				}</span>

				// start update handling
<span class="nc" id="L215">				final Class&lt; ? &gt; clazz = classLoader.loadClass(&quot;games.stendhal.client.update.UpdateManager&quot;);</span>
<span class="nc" id="L216">				final Method method = clazz.getMethod(&quot;process&quot;, String.class, Properties.class, Boolean.class, ClassLoader.class);</span>
<span class="nc" id="L217">				method.invoke(clazz.newInstance(), jarFolder, bootProp, initialDownload, classLoader);</span>
<span class="nc" id="L218">			} catch (final SecurityException e) {</span>
<span class="nc" id="L219">				throw e;</span>
<span class="nc" id="L220">			} catch (final Exception e) {</span>
<span class="nc" id="L221">				unexpectedErrorHandling(&quot;State: UpdateManager\r\n&quot;, e);</span>
<span class="nc" id="L222">			}</span>
<span class="nc" id="L223">		}</span>

		/**
		 * store boot prop (if they were altered during update).
		 */
		private void storeBootProp() {
			try {
<span class="nc" id="L230">				saveBootProp();</span>
<span class="nc" id="L231">			} catch (final IOException e) {</span>
<span class="nc" id="L232">				LoneOptionDialog.showMessageDialog(&quot;Sorry, an error occurred while downloading the update. Could not write bootProperties&quot;);</span>
<span class="nc" id="L233">			}</span>
<span class="nc" id="L234">		}</span>

		/**
		 * load program.
		 */
		private void loadProgram() {
			// regenerate classloader stuff, because in handleUpdate additional
			// .jar-files may have been added

			try {
<span class="nc" id="L244">				final ClassLoader classLoader = createClassloader(true, false);</span>
<span class="nc" id="L245">				final Class&lt; ? &gt; clazz = classLoader.loadClass(className);</span>
<span class="nc" id="L246">				final Method method = clazz.getMethod(&quot;main&quot;, args.getClass());</span>
<span class="nc" id="L247">				method.invoke(null, (Object) args);</span>
<span class="nc" id="L248">			} catch (final Throwable e) {</span>
<span class="nc" id="L249">				unexpectedErrorHandling(&quot;State: in game\r\n&quot;, e);</span>
<span class="nc" id="L250">			}</span>

<span class="nc" id="L252">		}</span>

		@Override
		public T run() {
<span class="nc" id="L256">			init();</span>
<span class="nc" id="L257">			handleUpdate();</span>
<span class="nc" id="L258">			storeBootProp();</span>
<span class="nc" id="L259">			loadProgram();</span>
<span class="nc" id="L260">			return null;</span>
		}
	}

	/**
	 * Is this package signed? Note it does not validate the signature, just
	 * looks for the presence of one.
	 *
	 * @return true, if there is some kind of signature; false otherwise
	 */
	private boolean isSigned() {
		try {
<span class="nc" id="L272">			Object[] objects = this.getClass().getSigners();</span>
<span class="nc bnc" id="L273" title="All 4 branches missed.">			if (objects == null || objects.length == 0) {</span>
<span class="nc" id="L274">				System.err.println(&quot;Unsigned self built client.&quot;);</span>
<span class="nc" id="L275">				return false;</span>
			}
<span class="nc bnc" id="L277" title="All 2 branches missed.">			if (! (objects instanceof Certificate[])) {</span>
<span class="nc" id="L278">				System.err.println(&quot;Unknown signer class&quot;);</span>
<span class="nc" id="L279">				return false;</span>
			}

<span class="nc" id="L282">			Certificate[] certs = (Certificate[]) objects;</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">			for (Certificate cert : certs) {</span>
<span class="nc" id="L284">				byte[] key = cert.getPublicKey().getEncoded();</span>
<span class="nc" id="L285">				String keyStr = toHexString(hash(key));</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">				if (keyStr.equals(ClientGameConfiguration.get(&quot;UPDATE_SIGNER_KEY&quot;))) {</span>
<span class="nc" id="L287">					return true;</span>
				}
<span class="nc" id="L289">                System.err.println(&quot;Skipping unknown signature: &quot; + keyStr + &quot; from &quot; + cert);</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                if (cert instanceof X509Certificate) {</span>
<span class="nc" id="L291">                	System.err.println(&quot;   &quot; + ((X509Certificate) cert).getSubjectDN());</span>
                }

			}
<span class="nc" id="L295">			return false;</span>

			// Throwable: both errors and exceptions
<span class="nc" id="L298">		} catch (Throwable e) {</span>
<span class="nc" id="L299">			e.printStackTrace();</span>
		}
<span class="nc" id="L301">		return false;</span>
	}

	/**
	 * Return the hash of an array of bytes.
	 * This method is thread safe.
	 *
	 * @param value an array of bytes.
	 * @return the hash of an array of bytes.
	 * @throws NoSuchAlgorithmException
	 */
	private static final byte[] hash(final byte[] value) throws NoSuchAlgorithmException {
<span class="nc" id="L313">		MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;);</span>
<span class="nc" id="L314">		md.reset();</span>
<span class="nc" id="L315">		md.update(value);</span>
<span class="nc" id="L316">		return md.digest();</span>
	}

	/**
	 * Convert and array of bytes to a Hex string.
	 * @param bs array of bytes
	 * @return a string representing a hexadecimal number.
	 */
	private static final String toHexString(final byte[] bs) {
<span class="nc" id="L325">		String hex = &quot;0123456789ABCDEF&quot;;</span>
<span class="nc" id="L326">		StringBuilder res = new StringBuilder();</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">		for (byte b : bs) {</span>
<span class="nc" id="L328">			res.append(hex.charAt(((b &gt;&gt;&gt; 4) &amp; 0xF)));</span>
<span class="nc" id="L329">			res.append(hex.charAt((b &amp; 0xF)));</span>
		}
<span class="nc" id="L331">		return res.toString();</span>
	}


	/**
	 * Starts the main-method of specified class after dynamically building the
	 * classpath.
	 *
	 * @param className
	 *            name of class with &quot;main&quot;-method
	 * @param args
	 *            command line arguments
	 */
	public void boot(final String className, final String[] args) {
		try {
<span class="nc" id="L346">			System.setSecurityManager(null);</span>
<span class="nc" id="L347">		} catch (final Throwable t) {</span>
<span class="nc" id="L348">			t.printStackTrace(System.err);</span>
<span class="nc" id="L349">		}</span>

<span class="nc" id="L351">		boolean startSelfBuild = true;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">		if (isSigned()) {</span>
<span class="nc" id="L353">			startSelfBuild = false;</span>
			// official client, look for updates and integrate additional .jar
			// files
<span class="nc" id="L356">			System.err.println(&quot;Integrating old updates and looking for new ones&quot;);</span>
			try {
<span class="nc" id="L358">				AccessController.doPrivileged(new PrivilegedBoot&lt;Object&gt;(className, args));</span>
<span class="nc" id="L359">			} catch (final SecurityException e) {</span>
				// partly update
<span class="nc" id="L361">				e.printStackTrace();</span>

<span class="nc" id="L363">				int res = LoneOptionDialog.showConfirmDialog(&quot;Sorry an error occurred because of inconsistent code signing.\r\n&quot;</span>
						+ &quot;Delete update files so that they are downloaded again after you restart &quot;
						+ ClientGameConfiguration.get(&quot;GAME_NAME&quot;) + &quot;?\r\n&quot;
						+ &quot;Note: This exception can occur if you include signed jars into a self build client.&quot;,
						ClientGameConfiguration.get(&quot;GAME_NAME&quot;), JOptionPane.YES_NO_OPTION,
						JOptionPane.QUESTION_MESSAGE);
<span class="nc bnc" id="L369" title="All 2 branches missed.">				if (res == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L370">					clearUpdateFiles();</span>
<span class="nc" id="L371">					System.exit(-1);</span>
				}
<span class="nc" id="L373">				startSelfBuild = true;</span>
<span class="nc" id="L374">			}</span>
		}

<span class="nc bnc" id="L377" title="All 2 branches missed.">		if (startSelfBuild) {</span>
			// self build client, do not try to update it
<span class="nc" id="L379">			System.err.println(&quot;Self build client, starting without update .jar-files&quot;);</span>
			try {
<span class="nc" id="L381">				final ClassLoader classLoader = createClassloader(false, false);</span>
<span class="nc" id="L382">				final Class&lt; ? &gt; clazz = classLoader.loadClass(className);</span>
<span class="nc" id="L383">				final Method method = clazz.getMethod(&quot;main&quot;, args.getClass());</span>
<span class="nc" id="L384">				method.invoke(null, (Object) args);</span>
<span class="nc" id="L385">			} catch (final Exception err) {</span>
<span class="nc" id="L386">				err.printStackTrace(System.err);</span>
<span class="nc" id="L387">				LoneOptionDialog.showMessageDialog(&quot;Something nasty happened while trying to start your self build client: &quot;</span>
								+ err);
<span class="nc" id="L389">			}</span>
		}
<span class="nc" id="L391">	}</span>

	/**
	 * Handles exceptions during program invocation.
	 *
	 * @param message error message
	 * @param t exception
	 */
	void unexpectedErrorHandling(String message, final Throwable t) {
		// unwrap chained exceptions
<span class="nc" id="L401">		Throwable e = t;</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">		while (e.getCause() != null) {</span>
<span class="nc" id="L403">			e = e.getCause();</span>
		}

<span class="nc" id="L406">		e.printStackTrace();</span>

<span class="nc bnc" id="L408" title="All 2 branches missed.">		if (e instanceof OutOfMemoryError) {</span>
<span class="nc" id="L409">			LoneOptionDialog.showMessageDialog(&quot;Sorry, an OutOfMemoryError occurred. Please restart &quot;</span>
					+ ClientGameConfiguration.get(&quot;GAME_NAME&quot;) + &quot;.&quot;);
<span class="nc bnc" id="L411" title="All 6 branches missed.">		} else if (e instanceof LinkageError || e instanceof SecurityException || e instanceof ClassNotFoundException) {</span>
<span class="nc" id="L412">			int res = LoneOptionDialog.showConfirmDialog(message</span>
					+ &quot; Sorry an error occurred because of an inconsistent update state.\r\nDelete update files so that they are downloaded again after you restart &quot;
					+ ClientGameConfiguration.get(&quot;GAME_NAME&quot;) +&quot;?&quot;,
					ClientGameConfiguration.get(&quot;GAME_NAME&quot;), JOptionPane.YES_NO_OPTION,
					JOptionPane.QUESTION_MESSAGE);
<span class="nc bnc" id="L417" title="All 2 branches missed.">			if (res == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L418">				clearUpdateFiles();</span>
			}
<span class="nc" id="L420">		} else {</span>
<span class="nc" id="L421">			String errorMessage = stacktraceToString(e);</span>
<span class="nc" id="L422">			LoneOptionDialog.showMessageDialog(message</span>
					+ &quot; An unexpected error occurred.\r\nPlease open a bug report at http://sf.net/projects/arianne with this error message:\r\n&quot;
					+ errorMessage);
		}
<span class="nc" id="L426">		System.exit(1);</span>
<span class="nc" id="L427">	}</span>

	private void clearUpdateFiles() {
<span class="nc" id="L430">		bootProp.remove(&quot;load&quot;);</span>
<span class="nc" id="L431">		bootProp.remove(&quot;load-0.69&quot;);</span>
<span class="nc" id="L432">		bootProp.remove(&quot;load-0.86&quot;);</span>
<span class="nc" id="L433">		bootProp.remove(&quot;load-0.95&quot;);</span>
		try {
<span class="nc" id="L435">			saveBootProp();</span>
<span class="nc" id="L436">		} catch (final IOException e1) {</span>
<span class="nc" id="L437">			LoneOptionDialog.showMessageDialog(&quot;Could not write jar.properties&quot;);</span>
<span class="nc" id="L438">		}</span>
<span class="nc" id="L439">	}</span>

	/**
	 * converts a Throwable into a string representation
	 * @param e throwable
	 * @return string
	 */
	String stacktraceToString(Throwable e) {
<span class="nc" id="L447">		StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L448">		sb.append(e.getMessage());</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">		for (StackTraceElement frame : e.getStackTrace()) {</span>
<span class="nc" id="L450">			sb.append(&quot;\r\n&quot;);</span>
<span class="nc" id="L451">			sb.append(frame.toString());</span>
		}
<span class="nc" id="L453">		return sb.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>