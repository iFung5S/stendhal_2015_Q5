<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Algebra.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.common.math</a> &gt; <span class="el_source">Algebra.java</span></div><h1>Algebra.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2010 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.common.math;

import java.util.Arrays;

/**
 * Algebraic helper functions-
 * @author silvio
 */
<span class="pc bpc" id="L21" title="2 of 4 branches missed.">public final class Algebra</span>
{
    public static final float EPSILON = 0.0000001f;

    public static float[] vecf(float ...args)
    {
<span class="pc bpc" id="L27" title="6 of 8 branches missed.">		assert args.length &gt; 0;</span>
<span class="fc" id="L28">        return args;</span>
    }

	public static float[] homogenousf(float ...args)
    {
<span class="nc bnc" id="L33" title="All 8 branches missed.">		assert args.length &gt; 0;</span>

<span class="nc" id="L35">		int   l = args.length - 1;</span>
<span class="nc" id="L36">		float w = args[l];</span>

<span class="nc bnc" id="L38" title="All 4 branches missed.">		for(int i=0; i&lt;l; ++i)</span>
<span class="nc" id="L39">			args[i] *= w;</span>

<span class="nc" id="L41">        return args;</span>
    }

    public static boolean isEqual_Scalf(float a, float b)
    {
<span class="nc bnc" id="L46" title="All 4 branches missed.">        return Math.abs(a - b) &lt;= EPSILON;</span>
    }

    public static boolean isEqual_Vecf(float[] a, float[] b)
    {
<span class="nc bnc" id="L51" title="All 8 branches missed.">        assert a.length == b.length;</span>

<span class="nc bnc" id="L53" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
        {
<span class="nc bnc" id="L55" title="All 4 branches missed.">            if(Math.abs(a[i] - b[i]) &gt; EPSILON)</span>
<span class="nc" id="L56">                return false;</span>
        }

<span class="nc" id="L59">        return true;</span>
    }

    public static void mov_Vecf(float[] result, float[] vec)
    {
<span class="pc bpc" id="L64" title="6 of 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="pc bpc" id="L65" title="6 of 8 branches missed.">		assert vec    != null: &quot;method argument 2 is null&quot;;</span>
<span class="pc bpc" id="L66" title="6 of 8 branches missed.">		assert result.length == vec.length;</span>

<span class="fc bfc" id="L68" title="All 4 branches covered.">        for(int i=0; i&lt;vec.length; ++i)</span>
<span class="fc" id="L69">            result[i] = vec[i];</span>
<span class="fc" id="L70">    }</span>

    public static void mov_Vecf(float[] result, float a)
    {
<span class="pc bpc" id="L74" title="6 of 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="fc" id="L75">        Arrays.fill(result, a);</span>
<span class="fc" id="L76">    }</span>

    public static void add_Vecf(float[] result, float[] a, float[] b)
    {
<span class="nc bnc" id="L80" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L81" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L82" title="All 8 branches missed.">		assert b      != null: &quot;method argument 3 is null&quot;;</span>
<span class="nc bnc" id="L83" title="All 12 branches missed.">		assert result.length == a.length &amp;&amp; a.length == b.length;</span>

<span class="nc bnc" id="L85" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L86">            result[i] = a[i] + b[i];</span>
<span class="nc" id="L87">    }</span>

    public static void add_Vecf(float[] result, float[] a, float b)
    {
<span class="nc bnc" id="L91" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L92" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L93" title="All 8 branches missed.">		assert result.length == a.length;</span>

<span class="nc bnc" id="L95" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L96">            result[i] = a[i] + b;</span>
<span class="nc" id="L97">    }</span>

    public static void sub_Vecf(float[] result, float[] a, float[] b)
    {
<span class="nc bnc" id="L101" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L102" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L103" title="All 8 branches missed.">		assert b      != null: &quot;method argument 3 is null&quot;;</span>
<span class="nc bnc" id="L104" title="All 12 branches missed.">        assert result.length == a.length &amp;&amp; a.length == b.length;</span>

<span class="nc bnc" id="L106" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L107">            result[i] = a[i] - b[i];</span>
<span class="nc" id="L108">    }</span>

    public static void sub_Vecf(float[] result, float[] a, float b)
    {
<span class="nc bnc" id="L112" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L113" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L114" title="All 8 branches missed.">        assert result.length == a.length;</span>

<span class="nc bnc" id="L116" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L117">            result[i] = a[i] - b;</span>
<span class="nc" id="L118">    }</span>

    public static void mul_Vecf(float[] result, float[] a, float[] b)
    {
<span class="nc bnc" id="L122" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L123" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L124" title="All 8 branches missed.">		assert b      != null: &quot;method argument 3 is null&quot;;</span>
<span class="nc bnc" id="L125" title="All 12 branches missed.">        assert result.length == a.length &amp;&amp; a.length == b.length;</span>

<span class="nc bnc" id="L127" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L128">            result[i] = a[i] * b[i];</span>
<span class="nc" id="L129">    }</span>

    public static void mul_Vecf(float[] result, float[] a, float b)
    {
<span class="nc bnc" id="L133" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L134" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L135" title="All 8 branches missed.">        assert result.length == a.length;</span>

<span class="nc bnc" id="L137" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L138">            result[i] = a[i] * b;</span>
<span class="nc" id="L139">    }</span>

    public static void div_Vecf(float[] result, float[] a, float[] b)
    {
<span class="nc bnc" id="L143" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L144" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L145" title="All 8 branches missed.">		assert b      != null: &quot;method argument 3 is null&quot;;</span>
<span class="nc bnc" id="L146" title="All 12 branches missed.">        assert result.length == a.length &amp;&amp; a.length == b.length;</span>

<span class="nc bnc" id="L148" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L149">            result[i] = a[i] / b[i];</span>
<span class="nc" id="L150">    }</span>

    public static void div_Vecf(float[] result, float[] a, float b)
    {
<span class="nc bnc" id="L154" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L155" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L156" title="All 8 branches missed.">        assert result.length == a.length;</span>

<span class="nc bnc" id="L158" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L159">            result[i] = a[i] / b;</span>
<span class="nc" id="L160">    }</span>

    public static float dot_Vecf(float[] a, float[] b)
    {
<span class="nc bnc" id="L164" title="All 8 branches missed.">		assert a      != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L165" title="All 8 branches missed.">		assert b      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L166" title="All 8 branches missed.">        assert a.length == b.length;</span>

<span class="nc" id="L168">        float result = 0.0f;</span>

<span class="nc bnc" id="L170" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L171">            result += a[i] * b[i];</span>

<span class="nc" id="L173">        return result;</span>
    }

    public static void cross_Vec3f(float[] result, float[] a, float[] b)
    {
<span class="nc bnc" id="L178" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L179" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L180" title="All 8 branches missed.">		assert b      != null: &quot;method argument 3 is null&quot;;</span>
<span class="nc bnc" id="L181" title="All 16 branches missed.">        assert result.length == 3 &amp;&amp; a.length == 3 &amp;&amp; b.length == 3;</span>

<span class="nc" id="L183">        float x =  a[1] * b[2] - b[1] * a[2];</span>
<span class="nc" id="L184">        float y = -a[0] * b[2] + b[0] * a[2];</span>
<span class="nc" id="L185">        float z =  a[0] * b[1] - b[0] * a[1];</span>

<span class="nc" id="L187">        result[0] = x;</span>
<span class="nc" id="L188">        result[1] = y;</span>
<span class="nc" id="L189">        result[2] = z;</span>
<span class="nc" id="L190">    }</span>

    public static void cross_Vec2f(float[] result, float[] a)
    {
<span class="nc bnc" id="L194" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L195" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L196" title="All 12 branches missed.">        assert result.length == 2 &amp;&amp; a.length == 2;</span>

<span class="nc" id="L198">        float x = a[0];</span>
<span class="nc" id="L199">        float y = a[1];</span>

<span class="nc" id="L201">        result[0] =  y;</span>
<span class="nc" id="L202">        result[1] = -x;</span>
<span class="nc" id="L203">    }</span>

    public static float lengthSqrt_Vecf(float[] v)
    {
<span class="nc" id="L207">        return dot_Vecf(v,v);</span>
    }

    public static float length_Vecf(float[] v)
    {
<span class="nc" id="L212">        return (float)Math.sqrt(dot_Vecf(v,v));</span>
    }


    public static void normalize_Vecf(float[] result, float[] a)
    {
<span class="nc bnc" id="L218" title="All 8 branches missed.">		assert result != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L219" title="All 8 branches missed.">		assert a      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L220" title="All 8 branches missed.">        assert result.length == a.length;</span>

<span class="nc" id="L222">        float length = 1.0f / length_Vecf(a);</span>

<span class="nc bnc" id="L224" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
<span class="nc" id="L225">            result[i] = a[i] * length;</span>
<span class="nc" id="L226">    }</span>

    public static float distanceSqrt_Vecf(float[] a, float[] b)
    {
<span class="nc bnc" id="L230" title="All 8 branches missed.">		assert a      != null: &quot;method argument 1 is null&quot;;</span>
<span class="nc bnc" id="L231" title="All 8 branches missed.">		assert b      != null: &quot;method argument 2 is null&quot;;</span>
<span class="nc bnc" id="L232" title="All 8 branches missed.">        assert a.length == b.length;</span>

        float temp;
<span class="nc" id="L235">        float result = 0.0f;</span>

<span class="nc bnc" id="L237" title="All 4 branches missed.">        for(int i=0; i&lt;a.length; ++i)</span>
        {
<span class="nc" id="L239">            temp    = a[i] - b[i];</span>
<span class="nc" id="L240">            result += temp * temp;</span>
        }

<span class="nc" id="L243">        return result;</span>
    }

    public static float distance_Vecf(float[] a, float[] b)
    {
<span class="nc" id="L248">        return (float)Math.sqrt(distanceSqrt_Vecf(a, b));</span>
    }

	// ------------------------------------------------------------- //

	public static float[] mat(boolean horizontalVectors, float[] ...vectors)
	{
<span class="nc bnc" id="L255" title="All 8 branches missed.">		assert vectors.length    != 0;</span>
<span class="nc bnc" id="L256" title="All 8 branches missed.">		assert vectors[0]        != null;</span>
<span class="nc bnc" id="L257" title="All 8 branches missed.">		assert vectors[0].length != 0;</span>

<span class="nc" id="L259">		int     vecLength = vectors[0].length;</span>
<span class="nc" id="L260">		int     numVecs   = vectors.length;</span>
<span class="nc" id="L261">		float[] result    = new float[numVecs * vecLength];</span>
<span class="nc" id="L262">		int     index     = 0;</span>

<span class="nc bnc" id="L264" title="All 4 branches missed.">		if(horizontalVectors)</span>
		{
<span class="nc bnc" id="L266" title="All 4 branches missed.">			for(float[] vec: vectors)</span>
			{
<span class="nc bnc" id="L268" title="All 8 branches missed.">				assert vec.length == vecLength: &quot;all vectors must have equal length&quot;;</span>

<span class="nc" id="L270">				System.arraycopy(vec, 0, result, index, vecLength);</span>
<span class="nc" id="L271">				index += vecLength;</span>
			}
		}
		else
		{
<span class="nc bnc" id="L276" title="All 4 branches missed.">			for(float[] vec: vectors)</span>
			{
<span class="nc bnc" id="L278" title="All 8 branches missed.">				assert vec.length == vecLength: &quot;all vectors must have equal length&quot;;</span>

<span class="nc" id="L280">				int row = index;</span>

<span class="nc bnc" id="L282" title="All 4 branches missed.">				for(float val: vec)</span>
				{
<span class="nc" id="L284">					result[row] = val;</span>
<span class="nc" id="L285">					row += numVecs;</span>
				}

<span class="nc" id="L288">				++index;</span>
			}
		}

<span class="nc" id="L292">		return result;</span>
	}

	public static float[] mul_mat(float[] a, int rowsA, int colsA, float[] b, int rowsB, int colsB)
	{
<span class="nc bnc" id="L297" title="All 8 branches missed.">		assert colsA == rowsB;</span>
<span class="nc bnc" id="L298" title="All 8 branches missed.">		assert (rowsA * colsA) != 0;</span>
<span class="nc bnc" id="L299" title="All 8 branches missed.">		assert (rowsB * colsB) != 0;</span>

<span class="nc" id="L301">		int     resultSize = rowsA * colsB;</span>
<span class="nc" id="L302">		float[] result     = new float[resultSize];</span>
<span class="nc" id="L303">		int     ra         = 0; // current row for array a</span>
<span class="nc" id="L304">		int     rr         = 0; // current row for array result</span>

<span class="nc" id="L306">		Arrays.fill(result, 0.0f);</span>

<span class="nc bnc" id="L308" title="All 4 branches missed.">		while(ra &lt; resultSize)</span>
		{
<span class="nc bnc" id="L310" title="All 4 branches missed.">			for(int cb=0; cb&lt;colsB; ++cb)</span>
			{
<span class="nc" id="L312">				int ib = cb; // current index for array b</span>

<span class="nc bnc" id="L314" title="All 4 branches missed.">				for(int d=0; d&lt;colsA; ++d)</span>
				{
<span class="nc" id="L316">					result[rr + cb] += a[ra + d] * b[ib];</span>
<span class="nc" id="L317">					ib += colsB;</span>
				}
			}

<span class="nc" id="L321">			ra += colsA;</span>
<span class="nc" id="L322">			rr += colsB;</span>
		}

<span class="nc" id="L325">		return result;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>