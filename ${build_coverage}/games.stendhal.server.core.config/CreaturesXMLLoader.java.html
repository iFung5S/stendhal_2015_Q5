<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CreaturesXMLLoader.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.core.config</a> &gt; <span class="el_source">CreaturesXMLLoader.java</span></div><h1>CreaturesXMLLoader.java</h1><pre class="source lang-java linenums">/* $Id$ */
/***************************************************************************
 *                   (C) Copyright 2003-2010 - Stendhal                    *
 ***************************************************************************
 ***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
package games.stendhal.server.core.config;

import games.stendhal.common.constants.Nature;
import games.stendhal.server.core.rule.defaultruleset.DefaultCreature;
import games.stendhal.server.entity.creature.impl.DropItem;
import games.stendhal.server.entity.creature.impl.EquipItem;

import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.net.URI;
import java.util.Arrays;
import java.util.EnumMap;
import java.util.LinkedHashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;

import javax.xml.parsers.ParserConfigurationException;
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;

import org.apache.log4j.Logger;
import org.xml.sax.Attributes;
import org.xml.sax.SAXException;
import org.xml.sax.helpers.DefaultHandler;

public final class CreaturesXMLLoader extends DefaultHandler {
	/** the logger instance. */
<span class="fc" id="L42">	private static final Logger logger = Logger.getLogger(CreaturesXMLLoader.class);</span>

	private String name;

	private String clazz;

	private String subclass;

	private String description;

	private String text;

	private String tileid;

	private int atk;

	private int def;

	private int hp;

	private double speed;

	private int sizeWidth;

	private int sizeHeight;

	private int xp;

	private int level;

	private int respawn;

	private List&lt;DropItem&gt; dropsItems;

	private List&lt;EquipItem&gt; equipsItems;

	/** List of possible sound events. */
	private List&lt;String&gt; sounds;
	
	/** Sound played on creature death */
	private String deathSound;
	
	/** Looped sound effect for moving creature */
	private String movementSound;

	private LinkedHashMap&lt;String, LinkedList&lt;String&gt;&gt; creatureSays;

	private Map&lt;String, String&gt; aiProfiles;

	private List&lt;DefaultCreature&gt; list;
	
	private String bloodName;

	private String corpseName;
	
	private String harmlessCorpseName;

	private int corpseWidth;

	private int corpseHeight;

	private boolean drops;

	private boolean equips;

	private boolean ai;

	private boolean says;

	private boolean attributes;

	private boolean abilities;
	
	private String statusAttack;
	
	private double statusAttackProbability;

	/** Susceptibilities of a creature */
	private EnumMap&lt;Nature, Double&gt; susceptibilities;

	/** Type of the damage caused by the creature */
	private Nature damageType;
	/** Type of the damage caused by the creature when using ranged attacks. */
	private Nature rangedDamageType;

	private String condition;

<span class="fc" id="L129">	CreaturesXMLLoader() {</span>
		// hide constructor, use the CreatureGroupsXMLLoader instead
<span class="fc" id="L131">	}</span>

	public List&lt;DefaultCreature&gt; load(final URI ref) throws SAXException {
<span class="fc" id="L134">		list = new LinkedList&lt;DefaultCreature&gt;();</span>
		// Use the default (non-validating) parser
<span class="fc" id="L136">		final SAXParserFactory factory = SAXParserFactory.newInstance();</span>
		try {
			// Parse the input
<span class="fc" id="L139">			final SAXParser saxParser = factory.newSAXParser();</span>

<span class="fc" id="L141">			InputStream is = CreaturesXMLLoader.class.getResourceAsStream(ref.getPath());</span>

<span class="pc bpc" id="L143" title="1 of 2 branches missed.">			if (is == null) {</span>
<span class="nc" id="L144">				throw new FileNotFoundException(&quot;cannot find resource '&quot; + ref</span>
						+ &quot;' in classpath&quot;);
			}

			try {
<span class="fc" id="L149">				saxParser.parse(is, this);</span>
			} finally {
<span class="pc" id="L151">				is.close();</span>
<span class="fc" id="L152">			}</span>
<span class="nc" id="L153">		} catch (final ParserConfigurationException t) {</span>
<span class="nc" id="L154">			logger.error(t);</span>
<span class="nc" id="L155">		} catch (final IOException e) {</span>
<span class="nc" id="L156">			logger.error(e);</span>
<span class="nc" id="L157">			throw new SAXException(e);</span>
<span class="pc" id="L158">		}</span>
<span class="fc" id="L159">		return list;</span>
	}

	@Override
	public void startDocument() {
		// do nothing
<span class="fc" id="L165">	}</span>

	@Override
	public void endDocument() {
		// do nothing
<span class="fc" id="L170">	}</span>

	@Override
	public void startElement(final String namespaceURI, final String lName, final String qName,
			final Attributes attrs) {
<span class="fc" id="L175">		text = &quot;&quot;;</span>
<span class="fc bfc" id="L176" title="All 2 branches covered.">		if (qName.equals(&quot;creature&quot;)) {</span>
<span class="fc" id="L177">			name = attrs.getValue(&quot;name&quot;);</span>
<span class="fc" id="L178">			condition = attrs.getValue(&quot;condition&quot;);</span>
<span class="fc" id="L179">			drops = false;</span>
<span class="fc" id="L180">			ai = false;</span>
<span class="fc" id="L181">			dropsItems = new LinkedList&lt;DropItem&gt;();</span>
<span class="fc" id="L182">			equipsItems = new LinkedList&lt;EquipItem&gt;();</span>
<span class="fc" id="L183">			sounds = new LinkedList&lt;String&gt;();</span>
<span class="fc" id="L184">			creatureSays = new LinkedHashMap&lt;String, LinkedList&lt;String&gt;&gt;();</span>
<span class="fc" id="L185">			aiProfiles = new LinkedHashMap&lt;String, String&gt;();</span>
<span class="fc" id="L186">			description = null;</span>
<span class="fc" id="L187">			damageType = Nature.CUT;</span>
<span class="fc" id="L188">			susceptibilities = new EnumMap&lt;Nature, Double&gt;(Nature.class);</span>
<span class="fc" id="L189">			deathSound = null;</span>
<span class="fc" id="L190">			statusAttack = null;</span>
<span class="fc" id="L191">			statusAttackProbability = 0;</span>
<span class="fc bfc" id="L192" title="All 2 branches covered.">		} else if (qName.equals(&quot;type&quot;)) {</span>
<span class="fc" id="L193">			clazz = attrs.getValue(&quot;class&quot;);</span>
<span class="fc" id="L194">			subclass = attrs.getValue(&quot;subclass&quot;);</span>

<span class="fc" id="L196">			tileid = &quot;../../tileset/logic/creature/&quot; + attrs.getValue(&quot;tileid&quot;);</span>
<span class="fc bfc" id="L197" title="All 2 branches covered.">		} else if (qName.equals(&quot;level&quot;)) {</span>
<span class="fc" id="L198">			level = Integer.parseInt(attrs.getValue(&quot;value&quot;));</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">		} else if (qName.equals(&quot;experience&quot;)) {</span>
			// XP rewarded is right now 5% of the creature real XP
<span class="fc" id="L201">			xp = Integer.parseInt(attrs.getValue(&quot;value&quot;)) * 20;</span>
<span class="fc bfc" id="L202" title="All 2 branches covered.">		} else if (qName.equals(&quot;equips&quot;)) {</span>
<span class="fc" id="L203">			equips = true;</span>
<span class="pc bpc" id="L204" title="1 of 4 branches missed.">		} else if (qName.equals(&quot;slot&quot;) &amp;&amp; equips) {</span>
<span class="fc" id="L205">			String item = null;</span>
<span class="fc" id="L206">			String slot = null;</span>
<span class="fc" id="L207">			int quantity = 1;</span>

<span class="fc bfc" id="L209" title="All 2 branches covered.">			for (int i = 0; i &lt; attrs.getLength(); i++) {</span>
<span class="fc bfc" id="L210" title="All 2 branches covered.">				if (attrs.getQName(i).equals(&quot;item&quot;)) {</span>
<span class="fc" id="L211">					item = attrs.getValue(i);</span>
<span class="fc bfc" id="L212" title="All 2 branches covered.">				} else if (attrs.getQName(i).equals(&quot;name&quot;)) {</span>
<span class="fc" id="L213">					slot = attrs.getValue(i);</span>
<span class="pc bpc" id="L214" title="1 of 2 branches missed.">				} else if (attrs.getQName(i).equals(&quot;quantity&quot;)) {</span>
<span class="fc" id="L215">					quantity = Integer.parseInt(attrs.getValue(i));</span>
				}
			}
<span class="pc bpc" id="L218" title="2 of 4 branches missed.">			if ((item != null) &amp;&amp; (slot != null)) {</span>
<span class="fc" id="L219">				equipsItems.add(new EquipItem(slot, item, quantity));</span>
			}
<span class="fc bfc" id="L221" title="All 2 branches covered.">		} else if (qName.equals(&quot;respawn&quot;)) {</span>
<span class="fc" id="L222">			respawn = Integer.parseInt(attrs.getValue(&quot;value&quot;));</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">		} else if (qName.equals(&quot;blood&quot;)) {</span>
<span class="fc" id="L224">			bloodName = attrs.getValue(&quot;name&quot;);</span>
<span class="fc bfc" id="L225" title="All 2 branches covered.">		} else if (qName.equals(&quot;corpse&quot;)) {</span>
<span class="fc" id="L226">			corpseName = attrs.getValue(&quot;name&quot;);</span>
<span class="fc" id="L227">			harmlessCorpseName = attrs.getValue(&quot;harmless&quot;);</span>
<span class="fc" id="L228">			String value = attrs.getValue(&quot;width&quot;);</span>

			// Default to 1 for width and height to save the fingers
			// of the people writing the creatures
<span class="fc bfc" id="L232" title="All 2 branches covered.">			if (value != null) {</span>
<span class="fc" id="L233">				corpseWidth = Integer.parseInt(value);</span>
			} else {
<span class="fc" id="L235">				corpseWidth = 1;</span>
			}

<span class="fc" id="L238">			value = attrs.getValue(&quot;height&quot;);</span>
<span class="fc bfc" id="L239" title="All 2 branches covered.">			if (value != null) {</span>
<span class="fc" id="L240">				corpseHeight = Integer.parseInt(value);</span>
			} else {
<span class="fc" id="L242">				corpseHeight = 1;</span>
			}
<span class="fc bfc" id="L244" title="All 2 branches covered.">		} else if (qName.equals(&quot;drops&quot;)) {</span>
<span class="fc" id="L245">			drops = true;</span>
<span class="pc bpc" id="L246" title="1 of 4 branches missed.">		} else if (qName.equals(&quot;item&quot;) &amp;&amp; drops) {</span>
<span class="fc" id="L247">			String tempName = null;</span>
<span class="fc" id="L248">			Double probability = null;</span>
<span class="fc" id="L249">			String range = null;</span>

<span class="fc bfc" id="L251" title="All 2 branches covered.">			for (int i = 0; i &lt; attrs.getLength(); i++) {</span>
<span class="fc bfc" id="L252" title="All 2 branches covered.">				if (attrs.getQName(i).equals(&quot;value&quot;)) {</span>
<span class="fc" id="L253">					tempName = attrs.getValue(i);</span>
<span class="fc bfc" id="L254" title="All 2 branches covered.">				} else if (attrs.getQName(i).equals(&quot;probability&quot;)) {</span>
<span class="fc" id="L255">					probability = Double.parseDouble(attrs.getValue(i));</span>
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">				} else if (attrs.getQName(i).equals(&quot;quantity&quot;)) {</span>
<span class="fc" id="L257">					range = attrs.getValue(i);</span>
				}
			}

<span class="pc bpc" id="L261" title="3 of 6 branches missed.">			if ((tempName != null) &amp;&amp; (probability != null) &amp;&amp; (range != null)) {</span>
<span class="fc" id="L262">				logger.debug(tempName + &quot;:&quot; + probability + &quot;:&quot; + range);</span>
<span class="pc bpc" id="L263" title="1 of 2 branches missed.">				if (range.contains(&quot;[&quot;)) {</span>
<span class="fc" id="L264">					range = range.replace(&quot;[&quot;, &quot;&quot;);</span>
<span class="fc" id="L265">					range = range.replace(&quot;]&quot;, &quot;&quot;);</span>
<span class="fc" id="L266">					final String[] amount = range.split(&quot;,&quot;);</span>

<span class="fc" id="L268">					dropsItems.add(new DropItem(tempName, probability,</span>
							Integer.parseInt(amount[0]),
							Integer.parseInt(amount[1])));
<span class="fc" id="L271">				} else {</span>
<span class="nc" id="L272">					dropsItems.add(new DropItem(tempName, probability,</span>
							Integer.parseInt(range)));
				}
			}
<span class="fc bfc" id="L276" title="All 2 branches covered.">		} else if (qName.equals(&quot;attributes&quot;)) {</span>
<span class="fc" id="L277">			attributes = true;</span>
<span class="fc bfc" id="L278" title="All 4 branches covered.">		} else if (attributes &amp;&amp; qName.equals(&quot;atk&quot;)) {</span>
<span class="fc" id="L279">			atk = Integer.parseInt(attrs.getValue(&quot;value&quot;));</span>
<span class="fc bfc" id="L280" title="All 4 branches covered.">		} else if (attributes &amp;&amp; qName.equals(&quot;def&quot;)) {</span>
<span class="fc" id="L281">			def = Integer.parseInt(attrs.getValue(&quot;value&quot;));</span>
<span class="fc bfc" id="L282" title="All 4 branches covered.">		} else if (attributes &amp;&amp; qName.equals(&quot;hp&quot;)) {</span>
<span class="fc" id="L283">			hp = Integer.parseInt(attrs.getValue(&quot;value&quot;));</span>
<span class="fc bfc" id="L284" title="All 4 branches covered.">		} else if (attributes &amp;&amp; qName.equals(&quot;speed&quot;)) {</span>
<span class="fc" id="L285">			speed = Double.parseDouble(attrs.getValue(&quot;value&quot;));</span>
<span class="pc bpc" id="L286" title="1 of 4 branches missed.">		} else if (attributes &amp;&amp; qName.equals(&quot;size&quot;)) {</span>
<span class="fc" id="L287">			final String[] size = attrs.getValue(&quot;value&quot;).split(&quot;,&quot;);</span>

<span class="fc" id="L289">			sizeWidth = Integer.parseInt(size[0]);</span>
<span class="fc" id="L290">			sizeHeight = Integer.parseInt(size[1]);</span>
<span class="fc bfc" id="L291" title="All 2 branches covered.">		} else if (qName.equals(&quot;ai&quot;)) {</span>
<span class="fc" id="L292">			ai = true;</span>
<span class="fc bfc" id="L293" title="All 4 branches covered.">		} else if (ai &amp;&amp; qName.equals(&quot;profile&quot;)) {</span>
<span class="fc" id="L294">			aiProfiles.put(attrs.getValue(&quot;name&quot;), attrs.getValue(&quot;params&quot;));</span>
<span class="fc bfc" id="L295" title="All 4 branches covered.">		} else if (ai &amp;&amp; qName.equals(&quot;says&quot;)) {</span>
<span class="fc" id="L296">			says = true;</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">		} else if (says) {</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">			if (qName.equals(&quot;noise&quot;)) {</span>
<span class="fc" id="L299">				final String states = attrs.getValue(&quot;state&quot;);</span>
<span class="fc" id="L300">				final String value = attrs.getValue(&quot;value&quot;);</span>
<span class="fc" id="L301">				final List&lt;String&gt; keys=Arrays.asList(states.split(&quot; &quot;));</span>
				// no such state in noises, will add it
<span class="fc bfc" id="L303" title="All 2 branches covered.">				for (int i=0; i&lt;keys.size(); i++) {</span>
<span class="fc" id="L304">					final String key=keys.get(i);</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">					if(creatureSays.get(key)==null) {</span>
<span class="fc" id="L306">						final LinkedList&lt;String&gt; ll=new LinkedList&lt;String&gt;();</span>
<span class="fc" id="L307">						ll.add(value);</span>
<span class="fc" id="L308">						creatureSays.put(key, ll);</span>
						// no such value in existing state, will add it
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">					} else if (creatureSays.get(key).indexOf(value)==-1) {</span>
<span class="fc" id="L311">						creatureSays.get(key).add(value);</span>
						// both state and value already exists
					} else {
<span class="nc" id="L314">						logger.warn(&quot;CreatureXMLLoader: creature (&quot;+name+</span>
									&quot;): double definition for noise \&quot;&quot;+key+&quot;\&quot; (&quot;+value+&quot;)&quot;);
					}
				}
<span class="fc bfc" id="L318" title="All 2 branches covered.">			} else if (qName.equals(&quot;sound&quot;)) {</span>
<span class="fc" id="L319">				sounds.add(attrs.getValue(&quot;value&quot;));</span>
<span class="pc bpc" id="L320" title="1 of 2 branches missed.">			} else if (qName.equals(&quot;movement&quot;)) {</span>
<span class="fc" id="L321">				movementSound = attrs.getValue(&quot;value&quot;);</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">            } else if (qName.equals(&quot;death&quot;)) {</span>
<span class="nc" id="L323">                deathSound = attrs.getValue(&quot;value&quot;);</span>
			}
<span class="fc bfc" id="L325" title="All 2 branches covered.">		} else if (qName.equals(&quot;abilities&quot;)) {</span>
<span class="fc" id="L326">			abilities = true;</span>
<span class="fc bfc" id="L327" title="All 4 branches covered.">		} else if (abilities &amp;&amp; qName.equals(&quot;damage&quot;)) {</span>
<span class="fc" id="L328">			String value = attrs.getValue(&quot;type&quot;);</span>
<span class="fc bfc" id="L329" title="All 2 branches covered.">			if (value == null) {</span>
<span class="fc" id="L330">				value = &quot;cut&quot;;</span>
			}
<span class="fc" id="L332">			damageType = Nature.parse(value);</span>
<span class="fc" id="L333">			value = attrs.getValue(&quot;rangedType&quot;);</span>
<span class="fc bfc" id="L334" title="All 2 branches covered.">			if (value != null) {</span>
<span class="fc" id="L335">				rangedDamageType = Nature.parse(value);</span>
			}
<span class="pc bpc" id="L337" title="1 of 4 branches missed.">		} else if (abilities &amp;&amp; qName.equals(&quot;susceptibility&quot;)) {</span>
<span class="fc" id="L338">			Nature type = Nature.parse(attrs.getValue(&quot;type&quot;));</span>
<span class="fc" id="L339">			Double value = Double.valueOf(attrs.getValue(&quot;value&quot;));</span>
<span class="fc" id="L340">			susceptibilities.put(type, value);</span>
<span class="pc bpc" id="L341" title="3 of 4 branches missed.">		} else if (abilities &amp;&amp; qName.equals(&quot;statusattack&quot;)) {</span>
<span class="nc" id="L342">		    statusAttack = attrs.getValue(&quot;type&quot;);</span>
<span class="nc" id="L343">		    statusAttackProbability = Double.valueOf(attrs.getValue(&quot;value&quot;));</span>
		}
<span class="fc" id="L345">	}</span>

	@Override
	public void endElement(final String namespaceURI, final String sName, final String qName) {
<span class="fc bfc" id="L349" title="All 2 branches covered.">		if (qName.equals(&quot;creature&quot;)) {</span>

<span class="fc bfc" id="L351" title="All 2 branches covered.">			if (!XMLUtil.checkCondition(condition)) {</span>
<span class="fc" id="L352">				return;</span>
			}

<span class="pc bpc" id="L355" title="1 of 2 branches missed.">			if (!tileid.contains(&quot;:&quot;)) {</span>
<span class="nc" id="L356">				logger.error(&quot;Corrupt XML file: Bad tileid for creature(&quot; + name + &quot;)&quot;);</span>
<span class="nc" id="L357">				return;</span>
			}

<span class="fc" id="L360">			final DefaultCreature creature = new DefaultCreature(clazz, subclass, name, tileid);</span>
<span class="fc" id="L361">			creature.setRPStats(hp, atk, def, speed);</span>
<span class="fc" id="L362">			creature.setLevel(level, xp);</span>
<span class="fc" id="L363">			creature.setSize(sizeWidth, sizeHeight);</span>
<span class="fc" id="L364">			creature.setEquipedItems(equipsItems);</span>

<span class="fc" id="L366">			creature.setBlood(bloodName);</span>
<span class="fc" id="L367">			bloodName = null;</span>

<span class="fc" id="L369">			creature.setCorpse(corpseName, harmlessCorpseName, corpseWidth, corpseHeight);</span>
<span class="fc" id="L370">			corpseName = null;</span>
<span class="fc" id="L371">			harmlessCorpseName = null;</span>
<span class="fc" id="L372">			corpseWidth = corpseHeight = 1;</span>

<span class="fc" id="L374">			creature.setDropItems(dropsItems);</span>
<span class="fc" id="L375">			creature.setAIProfiles(aiProfiles);</span>
<span class="fc" id="L376">			creature.setNoiseLines(creatureSays);</span>
<span class="fc" id="L377">			creature.setRespawnTime(respawn);</span>
<span class="fc" id="L378">			creature.setDescription(description);</span>
<span class="fc" id="L379">			creature.setSusceptibilities(susceptibilities);</span>
<span class="fc" id="L380">			creature.setDamageTypes(damageType, rangedDamageType);</span>
<span class="fc" id="L381">			creature.setCreatureSounds(sounds);</span>
<span class="fc" id="L382">			creature.setCreatureDeathSound(deathSound);</span>
<span class="fc" id="L383">			creature.setCreatureMovementSound(movementSound);</span>
			
<span class="pc bpc" id="L385" title="1 of 2 branches missed.">			if (statusAttack != null) {</span>
<span class="nc" id="L386">			    creature.setStatusAttack(statusAttack, statusAttackProbability);</span>
			}
			
<span class="fc" id="L389">			list.add(creature);</span>
<span class="fc bfc" id="L390" title="All 2 branches covered.">		} else if (qName.equals(&quot;attributes&quot;)) {</span>
<span class="fc" id="L391">			attributes = false;</span>
<span class="fc bfc" id="L392" title="All 2 branches covered.">		} else if (qName.equals(&quot;equips&quot;)) {</span>
<span class="fc" id="L393">			equips = false;</span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">		} else if (qName.equals(&quot;drops&quot;)) {</span>
<span class="fc" id="L395">			drops = false;</span>
<span class="fc bfc" id="L396" title="All 4 branches covered.">		} else if (ai &amp;&amp; qName.equals(&quot;says&quot;)) {</span>
<span class="fc" id="L397">			says = false;</span>
<span class="fc bfc" id="L398" title="All 2 branches covered.">		} else if (qName.equals(&quot;ai&quot;)) {</span>
<span class="fc" id="L399">			ai = false;</span>
<span class="fc bfc" id="L400" title="All 2 branches covered.">		} else if (qName.equals(&quot;description&quot;)) {</span>
<span class="pc bpc" id="L401" title="1 of 2 branches missed.">			if (text != null) {</span>
<span class="fc" id="L402">				description = text.trim();</span>
			}
<span class="fc" id="L404">			text = &quot;&quot;;</span>
<span class="fc bfc" id="L405" title="All 2 branches covered.">		} else if (qName.equals(&quot;abilities&quot;)) {</span>
<span class="fc" id="L406">			abilities = false;</span>
		}
<span class="fc" id="L408">	}</span>

	@Override
	public void characters(final char[] buf, final int offset, final int len) {
<span class="fc" id="L412">		text = text + (new String(buf, offset, len)).trim() + &quot; &quot;;</span>
<span class="fc" id="L413">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>