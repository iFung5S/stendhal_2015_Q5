<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FixedPath.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">stendhal</a> &gt; <a href="index.source.html" class="el_package">games.stendhal.server.core.pathfinder</a> &gt; <span class="el_source">FixedPath.java</span></div><h1>FixedPath.java</h1><pre class="source lang-java linenums">/*
 * @(#) src/games/stendhal/server/pathfinder/FixedPath.java
 *
 * $Id$
 */

package games.stendhal.server.core.pathfinder;

//
//

import games.stendhal.server.entity.ActiveEntity;

import java.util.List;

import org.apache.log4j.Logger;

/**
 * A path using a fixed route.
 */
public class FixedPath {

	/**
	 * The logger.
	 */
<span class="fc" id="L26">	private static final Logger LOGGER = Logger.getLogger(FixedPath.class);</span>

	/**
	 * The current goal node.
	 */
	protected Node currentGoal;

	/**
	 * Whether to loop the path.
	 */
	protected boolean loop;

	/**
	 * The path nodes.
	 */
	protected List&lt;Node&gt; nodes;

	/**
	 * The current position.
	 */
	protected int pos;

	/**
	 * Create a fixed path from a list. NOTE: The list is not copied, and should
	 * not be modified afterward.
	 * 
	 * @param nodes
	 *            A list of nodes to follow.
	 * @param loop
	 *            Whether the path should loop.
	 */
<span class="fc" id="L57">	public FixedPath(final List&lt;Node&gt; nodes, final boolean loop) {</span>
<span class="fc" id="L58">		this.nodes = nodes;</span>
<span class="fc" id="L59">		this.loop = loop;</span>

<span class="fc" id="L61">		pos = 0;</span>

<span class="pc bpc" id="L63" title="1 of 2 branches missed.">		if (nodes.isEmpty()) {</span>
<span class="nc" id="L64">			currentGoal = null;</span>
		} else {
<span class="fc" id="L66">			currentGoal = nodes.get(0);</span>
		}

<span class="fc" id="L69">	}</span>

	//
	// FixedPath
	//

	/**
	 * Add a node to the path.
	 * 
	 * @param node
	 *            The node to add.
	 */
	void add(final Node node) {
<span class="nc" id="L82">		nodes.add(node);</span>

<span class="nc bnc" id="L84" title="All 2 branches missed.">		if (currentGoal == null) {</span>
<span class="nc" id="L85">			currentGoal = node;</span>
		}
<span class="nc" id="L87">	}</span>

	/**
	 * Get the current goal.
	 * 
	 * @return The current goal to reach, or &lt;code&gt;null&lt;/code&gt;.
	 */
	public Node getCurrentGoal() {
<span class="nc" id="L95">		return currentGoal;</span>
	}

	/**
	 * Get the list of nodes that make up the path. NOTE: The list is not
	 * copied, and should not be modified.
	 * 
	 * @return The node list.
	 */
	public List&lt;Node&gt; getNodeList() {
<span class="fc" id="L105">		return nodes;</span>
	}

	/**
	 * Get the array of nodes that make up the path.
	 * 
	 * @return The nodes.
	 */
	public Node[] getNodes() {
<span class="nc" id="L114">		return nodes.toArray(new Node[nodes.size()]);</span>
	}

	/**
	 * Determine if the path is an infinite loop.
	 * 
	 * @return &lt;code&gt;true&lt;/code&gt; if the path loops when the last point is
	 *         reached.
	 */
	public boolean isLoop() {
<span class="nc" id="L124">		return loop;</span>
	}

	/**
	 * Follow this path. This will face the entity into the proper direction to
	 * reach it's next path goal.
	 * 
	 * @param entity
	 *            The entity to direct along the path.
	 * 
	 * @return &lt;code&gt;true&lt;/code&gt; if something to follow, &lt;code&gt;false&lt;/code&gt;
	 *         if complete.
	 */

	public boolean follow(final ActiveEntity entity) {
		/*
		 * Without goals, we'll never get anywhere in life
		 */
<span class="nc bnc" id="L142" title="All 2 branches missed.">		if (currentGoal == null) {</span>
<span class="nc" id="L143">			return false;</span>
		}

		/*
		 * Met our current goal?
		 */
<span class="nc bnc" id="L149" title="All 4 branches missed.">		if ((currentGoal.getX() == entity.getX())</span>
				&amp;&amp; (currentGoal.getY() == entity.getY())) {
<span class="nc bnc" id="L151" title="All 2 branches missed.">			if (LOGGER.isDebugEnabled()) {</span>
<span class="nc" id="L152">				LOGGER.debug(&quot;Completed waypoint #&quot; + pos + &quot;@&quot; + currentGoal</span>
						+ &quot; on Path&quot;);
			}

<span class="nc bnc" id="L156" title="All 2 branches missed.">			if (++pos &gt;= nodes.size()) {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">				if (!isLoop()) {</span>
<span class="nc" id="L158">					LOGGER.debug(&quot;Completed path&quot;);</span>
<span class="nc" id="L159">					return false;</span>
				}

<span class="nc" id="L162">				pos = 0;</span>
			}

<span class="nc" id="L165">			currentGoal = nodes.get(pos);</span>
		}

<span class="nc bnc" id="L168" title="All 2 branches missed.">		if (LOGGER.isDebugEnabled()) {</span>
<span class="nc" id="L169">			LOGGER.debug(&quot;Moving to waypoint #&quot; + pos + &quot;@&quot; + currentGoal</span>
					+ &quot; on Path from (&quot; + entity.getX() + &quot;,&quot; + entity.getY()
					+ &quot;)&quot;);
		}

<span class="nc" id="L174">		entity.faceto(currentGoal.getX(), currentGoal.getY());</span>

<span class="nc" id="L176">		return true;</span>
	}

	/**
	 * Get the final destination point.
	 * 
	 * @return The destination node, or &lt;code&gt;null&lt;/code&gt; if there is none
	 *         (i.e. no path, or unbound/infinite movement).
	 */

	public Node getDestination() {
<span class="nc bnc" id="L187" title="All 4 branches missed.">		if (loop || nodes.isEmpty()) {</span>
<span class="nc" id="L188">			return null;</span>
		} else {
<span class="nc" id="L190">			return nodes.get(nodes.size() - 1);</span>
		}
	}

	/**
	 * Determine if the path has finished.
	 * 
	 * @return &lt;code&gt;true&lt;/code&gt; if there is no more path to follow.
	 */

	public boolean isFinished() {
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">		return (currentGoal == null);</span>
	}

	//
	// Object
	//

	/**
	 * Get the string representation.
	 * 
	 * @return The string representation.
	 */
	@Override
	public String toString() {
<span class="nc" id="L215">		final StringBuilder sbuf = new StringBuilder();</span>

<span class="nc" id="L217">		sbuf.append(&quot;FixedPath[&quot;);</span>
<span class="nc" id="L218">		sbuf.append(nodes);</span>
<span class="nc" id="L219">		sbuf.append(&quot;@&lt;&quot;);</span>
<span class="nc" id="L220">		sbuf.append(pos);</span>
<span class="nc" id="L221">		sbuf.append(&quot;&gt;]&quot;);</span>

<span class="nc" id="L223">		return sbuf.toString();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>